# Rustç¨‹åºè®¾è®¡è¯­è¨€/Rust æƒå¨æŒ‡å—

æ­¤æ–‡ä»¶ä¸ºé˜…è¯»[ã€ŠRustç¨‹åºè®¾è®¡è¯­è¨€ã€‹ä¸­æ–‡ç‰ˆ]([Rust ç¨‹åºè®¾è®¡è¯­è¨€ - Rust ç¨‹åºè®¾è®¡è¯­è¨€ ä¸­æ–‡ç‰ˆ (rustwiki.org)](https://rustwiki.org/zh-CN/book/title-page.html))åï¼Œæ‘˜æŠ„çš„éƒ¨åˆ†å†…å®¹ã€‚

## å˜é‡å’Œå¯å˜æ€§

#### å˜é‡

- **é»˜è®¤**æƒ…å†µä¸‹å˜é‡æ˜¯**ä¸å¯å˜çš„**ï¼ˆ*immutable*)ã€‚
- å½“å˜é‡ä¸å¯å˜æ—¶ï¼Œæ„å‘³ç€ä¸€ä¸ªå€¼ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡ååï¼Œå°±ä¸èƒ½æ›´æ”¹å€¼äº†ã€‚
- é€šè¿‡åœ¨å˜é‡åå‰é¢åŠ ä¸Š **`mut`** å¯ä½¿å¾—å¯å˜ã€‚ 

#### å¸¸é‡(constant)

- å¸¸é‡æ˜¯ç»‘å®šåˆ°ä¸€ä¸ªå¸¸é‡åä¸”**ä¸å…è®¸æ›´æ”¹**çš„å€¼ï¼Œä¸å…è®¸ä½¿ç”¨  **`mmt`**ï¼Œè‡ªå§‹è‡³ç»ˆä¸å¯å˜ã€‚
- å¸¸é‡çš„å‘½åçº¦å®šæ˜¯å…¨éƒ¨å­—æ¯éƒ½ä½¿ç”¨**å¤§å†™**ï¼Œå¹¶ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯ã€‚
- å¸¸é‡ä½¿ç”¨  **`const`** å…³é”®å­—æ¥å£°æ˜ï¼Œå¹¶ä¸”å€¼çš„ç±»å‹å¿…é¡»æ³¨æ˜ã€‚
- å¸¸é‡å¯ä»¥åœ¨ä»»æ„ä½œç”¨åŸŸå†…å£°æ˜ï¼ŒåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸã€‚
- å¸¸é‡åªèƒ½è®¾ç½®ä¸ºå¸¸é‡è¡¨è¾¾å¼ï¼š
  - ä¸èƒ½æ˜¯å‡½æ•°è°ƒç”¨çš„ç»“æœã€‚
  - å¯ä»¥æ˜¯åœ¨è¿è¡Œæ—¶è®¡ç®—å¾—åˆ°çš„å€¼ã€‚

*å°†æ•´ä¸ªç¨‹åºä¸­ç”¨åˆ°çš„ç¡¬ç¼–ç ï¼ˆhardcodeï¼‰å€¼å‘½åä¸ºå¸¸é‡ï¼Œå¯¹äºå°†è¯¥å€¼çš„å«ä¹‰ä¼ è¾¾ç»™ä»£ç çš„æœªæ¥ç»´æŠ¤è€…å¾ˆæœ‰ç”¨ã€‚*

#### é®è”½(shadow)

- å£°æ˜å’Œå‰é¢å˜é‡å…·æœ‰ç›¸åŒåç§°çš„æ–°å˜é‡ï¼Œç§°ä¹‹ä¸ºå˜é‡**é®è”½**ã€‚
- *ä½¿ç”¨ `mut` ä¸èƒ½ä¿®æ”¹å˜é‡çš„ç±»å‹ï¼Œå˜é‡é®è”½å¯ä»¥è®©æˆ‘ä»¬ä¸å¿…ç»™å‡ºä¸åŒçš„åç§°ï¼Œè¿›è¡Œå˜é‡ç±»å‹çš„ä¿®æ”¹ã€‚*



## æ•°æ®ç±»å‹

### æ ‡é‡(scalar)ç±»å‹

- æ ‡é‡ç±»å‹è¡¨ç¤ºå•ä¸ªå€¼ã€‚Rustæœ‰4ä¸ªåŸºæœ¬çš„æ ‡é‡ç±»å‹ã€‚
  - æ•´å‹
  - æµ®ç‚¹å‹
  - å¸ƒå°”å‹
  - å­—ç¬¦

#### æ•´æ•°(integer)ç±»å‹

- æ•´æ•°æ˜¯æ²¡æœ‰å°æ•°éƒ¨åˆ†çš„æ•°å­—

- **æœ‰ç¬¦å·**å’Œ**æ— ç¬¦å·**è¡¨ç¤ºæ•°å­—èƒ½å¦å–è´Ÿæ•°ã€‚

- æœ‰ç¬¦å·æ•°å­—ä»¥äºŒè¿›åˆ¶è¡¥ç å½¢å¼å­˜å‚¨ã€‚

  |     æ•°å­—å­—é¢é‡     |     ç¤ºä¾‹      |
  | :----------------: | :-----------: |
  |       åè¿›åˆ¶       |   `98_222`    |
  |      åå…­è¿›åˆ¶      |    `0xff`     |
  |       å…«è¿›åˆ¶       |    `0o77`     |
  |       äºŒè¿›åˆ¶       | `0b1111_0000` |
  | å­—èŠ‚(ä»…é™äº `u8` ) |    `b'A'`     |

  ------

  ##### æ•´å‹æº¢å‡º

  æ¯”æ–¹è¯´æœ‰ä¸€ä¸ª `u8` ï¼Œå®ƒå¯ä»¥å­˜æ”¾ä» 0 åˆ° 255 çš„å€¼ã€‚é‚£ä¹ˆå½“ä½ å°†å…¶ä¿®æ”¹ä¸ºèŒƒå›´ä¹‹å¤–çš„å€¼ï¼Œæ¯”å¦‚ 256ï¼Œåˆ™ä¼šå‘ç”Ÿ**æ•´å‹æº¢å‡º**ï¼ˆ*integer overflow*ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´ä¸¤ç§è¡Œä¸ºçš„å…¶ä¸­ä¸€ç§ã€‚å½“åœ¨è°ƒè¯•ï¼ˆdebugï¼‰æ¨¡å¼ç¼–è¯‘æ—¶ï¼ŒRust ä¼šæ£€æŸ¥æ•´å‹æº¢å‡ºï¼Œè‹¥å­˜åœ¨è¿™äº›é—®é¢˜åˆ™ä½¿ç¨‹åºåœ¨ç¼–è¯‘æ—¶ *panic*ï¼ˆææ…Œï¼‰ã€‚Rust ä½¿ç”¨ panic è¿™ä¸ªæœ¯è¯­æ¥è¡¨æ˜ç¨‹åºå› é”™è¯¯è€Œé€€å‡ºã€‚

  åœ¨å½“ä½¿ç”¨ `--release` å‚æ•°è¿›è¡Œå‘å¸ƒï¼ˆreleaseï¼‰æ¨¡å¼æ„å»ºæ—¶ï¼ŒRust **ä¸**æ£€æµ‹ä¼šå¯¼è‡´ panic çš„æ•´å‹æº¢å‡ºã€‚ç›¸åå½“æ£€æµ‹åˆ°æ•´å‹æº¢å‡ºæ—¶ï¼ŒRust ä¼šè¿›è¡Œä¸€ç§è¢«ç§°ä¸ºäºŒè¿›åˆ¶è¡¥ç åŒ…è£¹ï¼ˆ*twoâ€™s complement wrapping*ï¼‰çš„æ“ä½œã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¤§äºè¯¥ç±»å‹æœ€å¤§å€¼çš„æ•°å€¼ä¼šè¢«â€œåŒ…è£¹â€æˆè¯¥ç±»å‹èƒ½å¤Ÿæ”¯æŒçš„å¯¹åº”æ•°å­—çš„æœ€å°å€¼ã€‚æ¯”å¦‚åœ¨ `u8` çš„æƒ…å†µä¸‹ï¼Œ256 å˜æˆ 0ï¼Œ257 å˜æˆ 1ï¼Œä¾æ­¤ç±»æ¨ã€‚ç¨‹åºä¸ä¼š panicï¼Œä½†æ˜¯è¯¥å˜é‡çš„å€¼å¯èƒ½ä¸æ˜¯ä½ æœŸæœ›çš„å€¼ã€‚ä¾èµ–æ•´å‹æº¢å‡ºåŒ…è£¹çš„è¡Œä¸ºä¸æ˜¯ä¸€ç§æ­£ç¡®çš„åšæ³•ã€‚

  è¦æ˜¾å¼å¤„ç†æº¢å‡ºçš„å¯èƒ½æ€§ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†åº“é’ˆå¯¹åŸå§‹æ•°å­—ç±»å‹æä¾›çš„ä»¥ä¸‹ä¸€ç³»åˆ—æ–¹æ³•ï¼š

  - ä½¿ç”¨ `wrapping_*` æ–¹æ³•åœ¨æ‰€æœ‰æ¨¡å¼ä¸‹è¿›è¡ŒåŒ…è£¹ï¼Œä¾‹å¦‚ `wrapping_add`
  - å¦‚æœä½¿ç”¨ `checked_*` æ–¹æ³•æ—¶å‘ç”Ÿæº¢å‡ºï¼Œåˆ™è¿”å› `None` å€¼
  - ä½¿ç”¨ `overflowing_*` æ–¹æ³•è¿”å›è¯¥å€¼å’Œä¸€ä¸ªæŒ‡ç¤ºæ˜¯å¦å­˜åœ¨æº¢å‡ºçš„å¸ƒå°”å€¼
  - ä½¿ç”¨ `saturating_*` æ–¹æ³•ä½¿å€¼è¾¾åˆ°æœ€å°å€¼æˆ–æœ€å¤§å€¼

#### æµ®ç‚¹ç±»å‹

- æµ®ç‚¹æ•°ï¼ˆ*floating-point number*ï¼‰æ˜¯å¸¦æœ‰å°æ•°ç‚¹çš„æ•°å­—ã€‚
- Rust çš„æµ®ç‚¹å‹æ˜¯ `f32` å’Œ `f64`ï¼Œå®ƒä»¬çš„å¤§å°åˆ†åˆ«ä¸º 32 ä½å’Œ 64 ä½ã€‚é»˜è®¤æµ®ç‚¹ç±»å‹æ˜¯ `f64`

#### æ•°å­—è¿ç®—

- åŸºæœ¬æ•°å­¦è¿ç®—ï¼šåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•å’Œå–æ¨¡è¿ç®—ã€‚

  ```rust
  fn main() {
      // addition
      let sum = 5 + 10;
  
      // subtraction
      let difference = 95.5 - 4.3;
  
      // multiplication
      let product = 4 * 30;
  
      // division
      let quotient = 56.7 / 32.2;
      let floored = 2 / 3; // Results in 0
  
      // remainder
      let remainder = 43 % 5;
  }
  
  ```

  ##### è¿ç®—ç¬¦

  | è¿ç®—ç¬¦ | ç¤ºä¾‹                                             | è§£é‡Š                   | æ˜¯å¦å¯é‡è½½     |
  | ------ | ------------------------------------------------ | ---------------------- | -------------- |
  | `!`    | `ident!(...)`, `ident!{...}`, `ident![...]`      | å®å±•å¼€                 |                |
  | `!`    | `!expr`                                          | æŒ‰ä½éæˆ–é€»è¾‘é         | `Not`          |
  | `!=`   | `var != expr`                                    | ä¸ç­‰æ¯”è¾ƒ               | `PartialEq`    |
  | `%`    | `expr % expr`                                    | ç®—æœ¯å–æ¨¡               | `Rem`          |
  | `%=`   | `var %= expr`                                    | ç®—æœ¯å–æ¨¡ä¸èµ‹å€¼         | `RemAssign`    |
  | `&`    | `&expr`, `&mut expr`                             | å€Ÿç”¨                   |                |
  | `&`    | `&type`, `&mut type`, `&'a type`, `&'a mut type` | å€Ÿç”¨æŒ‡é’ˆç±»å‹           |                |
  | `&`    | `expr & expr`                                    | æŒ‰ä½ä¸                 | `BitAnd`       |
  | `&=`   | `var &= expr`                                    | æŒ‰ä½ä¸åŠèµ‹å€¼           | `BitAndAssign` |
  | `&&`   | `expr && expr`                                   | é€»è¾‘ä¸                 |                |
  | `*`    | `expr * expr`                                    | ç®—æœ¯ä¹˜æ³•               | `Mul`          |
  | `*=`   | `var *= expr`                                    | ç®—æœ¯ä¹˜æ³•ä¸èµ‹å€¼         | `MulAssign`    |
  | `*`    | `*expr`                                          | è§£å¼•ç”¨                 |                |
  | `*`    | `*const type`, `*mut type`                       | è£¸æŒ‡é’ˆ                 |                |
  | `+`    | `trait + trait`, `'a + trait`                    | å¤åˆç±»å‹é™åˆ¶           |                |
  | `+`    | `expr + expr`                                    | ç®—æœ¯åŠ æ³•               | `Add`          |
  | `+=`   | `var += expr`                                    | ç®—æœ¯åŠ æ³•ä¸èµ‹å€¼         | `AddAssign`    |
  | `,`    | `expr, expr`                                     | å‚æ•°ä»¥åŠå…ƒç´ åˆ†éš”ç¬¦     |                |
  | `-`    | `- expr`                                         | ç®—æœ¯å–è´Ÿ               | `Neg`          |
  | `-`    | `expr - expr`                                    | ç®—æœ¯å‡æ³•               | `Sub`          |
  | `-=`   | `var -= expr`                                    | ç®—æœ¯å‡æ³•ä¸èµ‹å€¼         | `SubAssign`    |
  | `->`   | `fn(...) -> type`, `|...| -> type`               | å‡½æ•°ä¸é—­åŒ…ï¼Œè¿”å›ç±»å‹   |                |
  | `.`    | `expr.ident`                                     | æˆå‘˜è®¿é—®               |                |
  | `..`   | `..`, `expr..`, `..expr`, `expr..expr`           | å³æ’é™¤èŒƒå›´             |                |
  | `..`   | `..expr`                                         | ç»“æ„ä½“æ›´æ–°è¯­æ³•         |                |
  | `..`   | `variant(x, ..)`, `struct_type { x, .. }`        | â€œä¸å‰©ä½™éƒ¨åˆ†â€çš„æ¨¡å¼ç»‘å®š |                |
  | `...`  | `expr...expr`                                    | æ¨¡å¼: èŒƒå›´åŒ…å«æ¨¡å¼     |                |
  | `/`    | `expr / expr`                                    | ç®—æœ¯é™¤æ³•               | `Div`          |
  | `/=`   | `var /= expr`                                    | ç®—æœ¯é™¤æ³•ä¸èµ‹å€¼         | `DivAssign`    |
  | `:`    | `pat: type`, `ident: type`                       | çº¦æŸ                   |                |
  | `:`    | `ident: expr`                                    | ç»“æ„ä½“å­—æ®µåˆå§‹åŒ–       |                |
  | `:`    | `'a: loop {...}`                                 | å¾ªç¯æ ‡å¿—               |                |
  | `;`    | `expr;`                                          | è¯­å¥å’Œè¯­å¥ç»“æŸç¬¦       |                |
  | `;`    | `[...; len]`                                     | å›ºå®šå¤§å°æ•°ç»„è¯­æ³•çš„éƒ¨åˆ† |                |
  | `<<`   | `expr << expr`                                   | å·¦ç§»                   | `Shl`          |
  | `<<=`  | `var <<= expr`                                   | å·¦ç§»ä¸èµ‹å€¼             | `ShlAssign`    |
  | `<`    | `expr < expr`                                    | å°äºæ¯”è¾ƒ               | `PartialOrd`   |
  | `<=`   | `expr <= expr`                                   | å°äºç­‰äºæ¯”è¾ƒ           | `PartialOrd`   |
  | `=`    | `var = expr`, `ident = type`                     | èµ‹å€¼/ç­‰å€¼              |                |
  | `==`   | `expr == expr`                                   | ç­‰äºæ¯”è¾ƒ               | `PartialEq`    |
  | `=>`   | `pat => expr`                                    | åŒ¹é…å‡†å¤‡è¯­æ³•çš„éƒ¨åˆ†     |                |
  | `>`    | `expr > expr`                                    | å¤§äºæ¯”è¾ƒ               | `PartialOrd`   |
  | `>=`   | `expr >= expr`                                   | å¤§äºç­‰äºæ¯”è¾ƒ           | `PartialOrd`   |
  | `>>`   | `expr >> expr`                                   | å³ç§»                   | `Shr`          |
  | `>>=`  | `var >>= expr`                                   | å³ç§»ä¸èµ‹å€¼             | `ShrAssign`    |
  | `@`    | `ident @ pat`                                    | æ¨¡å¼ç»‘å®š               |                |
  | `^`    | `expr ^ expr`                                    | æŒ‰ä½å¼‚æˆ–               | `BitXor`       |
  | `^=`   | `var ^= expr`                                    | æŒ‰ä½å¼‚æˆ–ä¸èµ‹å€¼         | `BitXorAssign` |
  | `|`    | `pat | pat`                                      | æ¨¡å¼é€‰æ‹©               |                |
  | `|`    | `expr | expr`                                    | æŒ‰ä½æˆ–                 | `BitOr`        |
  | `|=`   | `var |= expr`                                    | æŒ‰ä½æˆ–ä¸èµ‹å€¼           | `BitOrAssign`  |
  | `||`   | `expr || expr`                                   | é€»è¾‘æˆ–                 |                |
  | `?`    | `expr?`                                          | é”™è¯¯ä¼ æ’­               |                |

#### å¸ƒå°”ç±»å‹

- Rust ä¸­çš„å¸ƒå°”ç±»å‹æœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼š`true` å’Œ `false`ã€‚
- *ä½¿ç”¨å¸ƒå°”å€¼çš„ä¸»è¦åœ°æ–¹æ˜¯æ¡ä»¶åˆ¤æ–­ã€‚*

#### å­—ç¬¦(char)ç±»å‹

- Rust çš„ `char`ï¼ˆå­—ç¬¦ï¼‰ç±»å‹æ˜¯è¯¥è¯­è¨€æœ€åŸºæœ¬çš„å­—æ¯ç±»å‹ã€‚

- Rust çš„å­—ç¬¦ç±»å‹å¤§å°ä¸º**4 ä¸ªå­—èŠ‚**ï¼Œè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª Unicode æ ‡é‡å€¼ã€‚

- å£°æ˜çš„ `char` å­—é¢é‡é‡‡ç”¨å•å¼•å·æ‹¬èµ·æ¥ã€‚

- *ä¸å­—ç¬¦ä¸²å­—é¢é‡ä¸åŒï¼Œå­—ç¬¦ä¸²å­—é¢é‡æ˜¯ç”¨åŒå¼•å·æ‹¬èµ·æ¥ã€‚*

  ```rust
  fn main() {
      let c = 'z';
      let z = 'â„¤';
      let heart_eyed_cat = 'ğŸ˜»';
  }
  ```

  

### å¤åˆç±»å‹(compound type)

*ä¸¤ç§åŸºæœ¬çš„å¤åˆç±»å‹ï¼šå…ƒç»„ (tuple) å’Œæ•°ç»„ (array) ã€‚*

#### å…ƒç»„ç±»å‹

- **å…ƒç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå£°æ˜åå°±æ— æ³•å¢é•¿æˆ–ç¼©å°**ã€‚

- **å…ƒç»„çš„æ¯ä¸ªå…ƒç´ ä¸è¦æ±‚å…·æœ‰ç›¸åŒçš„ç±»å‹**ã€‚

  ------

  *å°æ‹¬å·å†…å†™å…¥ä»¥é€—å·åˆ†éš”çš„å€¼åˆ—è¡¨æ¥åˆ›å»ºä¸€ä¸ªå…ƒç»„*

  ```rust
  fn main() {
      // æ˜¾å¼å£°æ˜å€¼ç±»å‹
      let tup: (i32, f64, u8) = (500, 6.4, 1);
  }
  ```

  å˜é‡ `tup` ç»‘å®šåˆ°æ•´ä¸ªå…ƒç»„ï¼Œå› ä¸ºå…ƒç»„è¢«è®¤ä½œæ˜¯å•ä¸ªå¤åˆå…ƒç´ ã€‚ æƒ³ä»å…ƒç»„ä¸­è·å–ä¸ªåˆ«å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥è§£æ„ï¼ˆdestructureï¼‰å…ƒç»„çš„ä¸€ä¸ªå€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

  ```rust
  fn main() {
      // éšå¼å£°æ˜å€¼ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨æ–­ç±»å‹
      let tup = (500, 6.4, 1);
  
      let (x, y, z) = tup;
  
      println!("The value of y is: {}", y);
  }
  ```

  è¯¥ç¨‹åºé¦–å…ˆåˆ›å»ºä¸€ä¸ªå…ƒç»„å¹¶å°†å…¶ç»‘å®šåˆ°å˜é‡ `tup` ä¸Šã€‚ ç„¶åå®ƒå€ŸåŠ© `let` æ¥ä½¿ç”¨ä¸€ä¸ªæ¨¡å¼åŒ¹é… `tup`ï¼Œå¹¶å°†å®ƒåˆ†è§£æˆä¸‰ä¸ªå•ç‹¬çš„å˜é‡ `x`ã€`y` å’Œ `z`ã€‚ è¿™è¿‡ç¨‹ç§°ä¸º**è§£æ„**ï¼ˆ*destructuring*ï¼‰ï¼Œå› ä¸ºå®ƒå°†å•ä¸ªå…ƒç»„åˆ†ä¸ºä¸‰éƒ¨åˆ†ã€‚æœ€åï¼Œç¨‹åºæ‰“å°å‡º `y` å€¼ï¼Œä¸º `6.4`ã€‚

  ```rust
  fn main() {
      let x: (i32, f64, u8) = (500, 6.4, 1);
  
      let five_hundred = x.0;
  
      let six_point_four = x.1;
  
      let one = x.2;
  }
  ```

  è¯¥ç¨‹åºåˆ›å»ºä¸€ä¸ªå…ƒç»„ `x`ï¼Œç„¶åé€šè¿‡ä½¿ç”¨å®ƒä»¬çš„ç´¢å¼•ä¸ºæ¯ä¸ªå…ƒç´ åˆ›å»ºæ–°çš„å˜é‡ã€‚å’Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œå…ƒç»„ä¸­çš„ç¬¬ä¸€ä¸ªç´¢å¼•ä¸º 0ã€‚

  æ²¡æœ‰ä»»ä½•å€¼çš„å…ƒç»„ `()` æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å‹ï¼Œåªæœ‰ä¸€ä¸ªå€¼ï¼Œä¹Ÿå†™æˆ `()`ã€‚è¯¥ç±»å‹è¢«ç§°ä¸º**å•å…ƒç±»å‹**ï¼ˆ*unit type*ï¼‰ï¼Œè¯¥å€¼è¢«ç§°ä¸º**å•å…ƒå€¼**ï¼ˆ*unit value*ï¼‰ã€‚å¦‚æœè¡¨è¾¾å¼ä¸è¿”å›ä»»ä½•å…¶ä»–å€¼ï¼Œå°±éšå¼åœ°è¿”å›å•å…ƒå€¼ã€‚*

#### æ•°ç»„ç±»å‹

- **æ•°ç»„çš„æ¯ä¸ªå…ƒç´ å¿…é¡»å…·æœ‰ç›¸åŒçš„ç±»å‹**ã€‚

- **æ•°ç»„å…·æœ‰å›ºå®šé•¿åº¦**ã€‚

  *æ–¹æ‹¬å·å†…ä»¥é€—å·åˆ†éš”çš„åˆ—è¡¨å½¢å¼å°†å€¼å†™åˆ°æ•°ç»„ä¸­ï¼š*

  ```rust
  fn main() {
      let a = [1, 2, 3, 4, 5];
  }
  ```

  å½“ä½ å¸Œæœ›å°†æ•°æ®åˆ†é…åˆ°æ ˆï¼ˆstackï¼‰è€Œä¸æ˜¯å †ï¼ˆheapï¼‰æ—¶ï¼Œæˆ–è€…å½“ä½ å¸Œæœ›ç¡®ä¿å§‹ç»ˆå…·æœ‰å›ºå®šæ•°é‡çš„å…ƒç´ æ—¶ï¼Œæ•°ç»„ç‰¹åˆ«æœ‰ç”¨ã€‚

  ä¸è¿‡å½“ä½ æ˜ç¡®å…ƒç´ æ•°é‡ä¸éœ€è¦æ”¹å˜æ—¶ï¼Œæ•°ç»„ä¼šæ›´æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ç¨‹åºä¸­ä½¿ç”¨æœˆä»½çš„åç§°ï¼Œä½ å¾ˆå¯èƒ½å¸Œæœ›ä½¿ç”¨çš„æ˜¯æ•°ç»„è€Œä¸æ˜¯ vectorï¼Œå› ä¸ºä½ çŸ¥é“å®ƒå§‹ç»ˆåŒ…å« 12 ä¸ªå…ƒç´ ï¼š

  ```rust
  let months = ["January", "February", "March", "April", "May", "June", "July",
                "August", "September", "October", "November", "December"];
  ```

  ä½¿ç”¨æ–¹æ‹¬å·ç¼–å†™æ•°ç»„çš„ç±»å‹ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªå…ƒç´ çš„ç±»å‹ã€åˆ†å·ï¼Œç„¶åæ˜¯æ•°ç»„ä¸­çš„å…ƒç´ æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

  ```rust
  // i32 æ˜¯æ¯ä¸ªå…ƒç´ çš„ç±»å‹ã€‚åˆ†å·ä¹‹åï¼Œæ•°å­— 5 è¡¨æ˜è¯¥æ•°ç»„åŒ…å« 5 ä¸ªå…ƒç´ ã€‚
  let a: [i32; 5] = [1, 2, 3, 4, 5];
  ```

  å¦‚æœè¦**ä¸ºæ¯ä¸ªå…ƒç´ åˆ›å»ºåŒ…å«ç›¸åŒå€¼çš„æ•°ç»„**ï¼Œå¯ä»¥æŒ‡å®šåˆå§‹å€¼ï¼Œåè·Ÿåˆ†å·ï¼Œç„¶ååœ¨æ–¹æ‹¬å·ä¸­æŒ‡å®šæ•°ç»„çš„é•¿åº¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

  ```rust
  // å˜é‡åä¸º a çš„æ•°ç»„å°†åŒ…å« 5 ä¸ªå…ƒç´ ï¼Œè¿™äº›å…ƒç´ çš„å€¼åˆå§‹åŒ–ä¸º 3ã€‚
  let a = [3; 5];	// a = [3, 3, 3, 3, 3]; 
  ```

  ##### è®¿é—®æ•°ç»„å…ƒç´ 

  **æ•°ç»„æ˜¯å¯ä»¥åœ¨æ ˆ(stack)ä¸Šåˆ†é…çš„å·²çŸ¥å›ºå®šå¤§å°çš„å•ä¸ªå†…å­˜å—**ã€‚å¯ä»¥ä½¿ç”¨ç´¢å¼•è®¿é—®æ•°ç»„çš„å…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

  ```rust
  fn main() {
      let a = [1, 2, 3, 4, 5];
      // first çš„å˜é‡å°†è·å¾—å€¼ 1ï¼Œå› ä¸ºå®ƒæ˜¯æ•°ç»„ä¸­ç´¢å¼• [0] å¤„çš„å€¼ã€‚
      let first = a[0];
      //  second çš„å˜é‡å°†ä»æ•°ç»„ä¸­çš„ç´¢å¼• [1] ä¸­è·å–å¾— 2ã€‚
      let second = a[1];
  }
  ```

  ##### æ— æ•ˆçš„æ•°ç»„å…ƒç´ è®¿é—®

  *å½“ä½ å°è¯•ä½¿ç”¨ç´¢å¼•è®¿é—®å…ƒç´ æ—¶ï¼ŒRust å°†æ£€æŸ¥ä½ æŒ‡å®šçš„ç´¢å¼•æ˜¯å¦å°äºæ•°ç»„é•¿åº¦ã€‚å¦‚æœç´¢å¼•å¤§äºæˆ–ç­‰äºæ•°ç»„é•¿åº¦ï¼ŒRust ä¼šå‡ºç° `panic`ã€‚*



## å‡½æ•°

- `fn` å…³é”®å­—ï¼Œå®ƒç”¨æ¥å£°æ˜æ–°å‡½æ•°ï¼Œåè·Ÿç€å‡½æ•°åå’Œä¸€å¯¹åœ†æ‹¬å·ã€‚
- Rust ä»£ç ä¸­çš„å‡½æ•°å’Œå˜é‡åä½¿ç”¨ä¸‹åˆ’çº¿å‘½åæ³•ï¼ˆ*snake case*ï¼Œç›´è¯‘ä¸ºè›‡å½¢å‘½åæ³•ï¼‰è§„èŒƒé£æ ¼ã€‚
- åœ¨ä¸‹åˆ’çº¿å‘½åæ³•ä¸­ï¼Œæ‰€æœ‰å­—æ¯éƒ½æ˜¯å°å†™å¹¶ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯ã€‚

#### å‚æ•°

å‡½æ•°ä¹Ÿå¯ä»¥è¢«å®šä¹‰ä¸ºæ‹¥æœ‰**å‚æ•°**ï¼ˆ*parameter*ï¼‰ï¼Œå‚æ•°æ˜¯ç‰¹æ®Šå˜é‡ï¼Œæ˜¯å‡½æ•°ç­¾åçš„ä¸€éƒ¨åˆ†ã€‚å½“å‡½æ•°æ‹¥æœ‰å‚æ•°ï¼ˆå½¢å‚ï¼‰æ—¶ï¼Œå¯ä»¥ä¸ºè¿™äº›å‚æ•°æä¾›å…·ä½“çš„å€¼ï¼ˆå®å‚ï¼‰ã€‚æŠ€æœ¯ä¸Šè®²ï¼Œè¿™äº›å…·ä½“å€¼è¢«ç§°ä¸º**å®å‚**ï¼ˆ*argument*ï¼‰ï¼Œä½†æ˜¯åœ¨æ—¥å¸¸äº¤æµä¸­ï¼Œäººä»¬å€¾å‘äºä¸åŒºåˆ†ä½¿ç”¨ *parameter* å’Œ *argument* æ¥è¡¨ç¤ºå‡½æ•°å®šä¹‰ä¸­çš„å˜é‡æˆ–è°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥çš„å…·ä½“å€¼ã€‚

åœ¨å‡½æ•°ç­¾åä¸­ï¼Œ**å¿…é¡»**å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹ã€‚è¿™æ˜¯ä¸€ä¸ª Rust è®¾è®¡ä¸­ç»è¿‡æ…é‡è€ƒè™‘çš„å†³å®šï¼šè¦æ±‚åœ¨å‡½æ•°å®šä¹‰ä¸­æä¾›ç±»å‹æ ‡æ³¨ï¼Œæ„å‘³ç€ç¼–è¯‘å™¨å‡ ä¹ä»ä¸éœ€è¦ä½ åœ¨ä»£ç çš„å…¶ä»–åœ°æ–¹æ³¨æ˜ç±»å‹æ¥æŒ‡å‡ºä½ çš„æ„å›¾ã€‚

#### è¯­å¥å’Œè¡¨è¾¾å¼

Rust æ˜¯ä¸€é—¨åŸºäºè¡¨è¾¾å¼ï¼ˆexpression-basedï¼‰çš„è¯­è¨€ï¼Œ**å‡½æ•°ä½“ç”±ä¸€ç³»åˆ—è¯­å¥ç»„æˆï¼Œä¹Ÿå¯é€‰æ‹©ä»¥è¡¨è¾¾å¼ç»“å°¾**ã€‚

**è¯­å¥ï¼ˆ*statement*ï¼‰æ˜¯æ‰§è¡Œä¸€äº›æ“ä½œä½†ä¸è¿”å›å€¼çš„æŒ‡ä»¤ã€‚è¡¨è¾¾å¼ï¼ˆ*expression*ï¼‰è®¡ç®—å¹¶äº§ç”Ÿä¸€ä¸ªå€¼**ã€‚è®©æˆ‘ä»¬çœ‹ä¸€äº›ä¾‹å­ï¼š	

```rust
// åŒ…å«ä¸€ä¸ªè¯­å¥çš„ main å‡½æ•°å®šä¹‰
fn main() {
    // ä½¿ç”¨ let å…³é”®å­—åˆ›å»ºå˜é‡å¹¶ç»‘å®šä¸€ä¸ªå€¼æ˜¯ä¸€ä¸ªè¯­å¥ã€‚
    let y = 6;
}
```

**å‡½æ•°å®šä¹‰ä¹Ÿæ˜¯è¯­å¥**ï¼Œä¸Šé¢æ•´ä¸ªä¾‹å­æœ¬èº«å°±æ˜¯ä¸€ä¸ªè¯­å¥ã€‚è¯­å¥ä¸è¿”å›å€¼ã€‚å› æ­¤ï¼Œä¸èƒ½æŠŠ `let` è¯­å¥èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡ã€‚`x = y = 6`ï¼Œ**åœ¨Rustä¸­ä¸èƒ½è¿™æ ·å­å†™**ã€‚

è¡¨è¾¾å¼ä¼šè®¡ç®—å‡ºä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”ä½ æ¥ä¸‹æ¥è¦ç”¨ Rust ç¼–å†™çš„å¤§éƒ¨åˆ†ä»£ç éƒ½ç”±è¡¨è¾¾å¼ç»„æˆã€‚è€ƒè™‘ä¸€ä¸ªæ•°å­¦è¿ç®—ï¼Œæ¯”å¦‚ `5 + 6`ï¼Œè¿™æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼å¹¶è®¡ç®—å‡ºå€¼ `11`ã€‚è¡¨è¾¾å¼å¯ä»¥æ˜¯è¯­å¥çš„ä¸€éƒ¨åˆ†ï¼šåœ¨ç¤ºä¾‹ 3-1 ä¸­ï¼Œè¯­å¥ `let y = 6;` ä¸­çš„ `6` æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒè®¡ç®—å‡ºçš„å€¼æ˜¯ `6`ã€‚**å‡½æ•°è°ƒç”¨**æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚**å®è°ƒç”¨**æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚æˆ‘ä»¬ç”¨æ¥åˆ›å»ºæ–°**ä½œç”¨åŸŸçš„å¤§æ‹¬å·**ï¼ˆä»£ç å—ï¼‰ `{}` ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š

```rust
fn main() {
    let y = {
        let x = 3;
        x + 1
    };

    println!("The value of y is: {}", y);
}
```

è¿™ä¸ªè¡¨è¾¾å¼ï¼š

```rust
{
    let x = 3;
    x + 1
}
```

æ˜¯ä¸€ä¸ªä»£ç å—ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­è®¡ç®—ç»“æœæ˜¯ `4`ã€‚è¿™ä¸ªå€¼ä½œä¸º `let` è¯­å¥çš„ä¸€éƒ¨åˆ†è¢«ç»‘å®šåˆ° `y` ä¸Šã€‚æ³¨æ„ï¼Œ`x + 1` è¡Œçš„æœ«å°¾æ²¡æœ‰åˆ†å·ï¼Œè¿™ä¸ä½ ç›®å‰è§è¿‡çš„å¤§éƒ¨åˆ†ä»£ç è¡Œä¸åŒã€‚è¡¨è¾¾å¼çš„ç»“å°¾æ²¡æœ‰åˆ†å·ã€‚å¦‚æœåœ¨è¡¨è¾¾å¼çš„æœ«å°¾åŠ ä¸Šåˆ†å·ï¼Œé‚£ä¹ˆå®ƒå°±è½¬æ¢ä¸ºè¯­å¥ï¼Œè€Œè¯­å¥ä¸ä¼šè¿”å›å€¼ã€‚åœ¨æ¥ä¸‹æ¥æ¢è®¨å‡½æ•°è¿”å›å€¼å’Œè¡¨è¾¾å¼æ—¶ï¼Œè¯·è®°ä½è¿™ä¸€ç‚¹ã€‚

#### å¸¦è¿”å›å€¼çš„å‡½æ•°

å‡½æ•°å¯ä»¥å‘è°ƒç”¨å®ƒçš„ä»£ç è¿”å›å€¼ã€‚æˆ‘ä»¬å¹¶ä¸å¯¹è¿”å›å€¼å‘½åï¼Œä½†è¦åœ¨ç®­å¤´ï¼ˆ`->`ï¼‰åå£°æ˜å®ƒçš„ç±»å‹ã€‚åœ¨ Rust ä¸­ï¼Œå‡½æ•°çš„è¿”å›å€¼ç­‰åŒäºå‡½æ•°ä½“æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ä½¿ç”¨ `return` å…³é”®å­—å’ŒæŒ‡å®šå€¼ï¼Œå¯ä»¥ä»å‡½æ•°ä¸­æå‰è¿”å›ï¼›ä½†**å¤§éƒ¨åˆ†å‡½æ•°éšå¼è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼**ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰è¿”å›å€¼å‡½æ•°çš„ä¾‹å­ï¼š

```rust
// åœ¨ `five` å‡½æ•°ä¸­æ²¡æœ‰å‡½æ•°è°ƒç”¨ã€å®ï¼Œç”šè‡³æ²¡æœ‰ `let` è¯­å¥â€”â€”åªæœ‰æ•°å­— `5` æœ¬èº«ã€‚è¿™åœ¨ Rust ä¸­æ˜¯ä¸€ä¸ªå®Œå…¨æœ‰æ•ˆçš„å‡½æ•°ã€‚
fn five() -> i32 {
    5
}

fn main() {
    let x = five();

    println!("The value of x is: {}", x);
}
```

åœ¨ `five` å‡½æ•°ä¸­æ²¡æœ‰å‡½æ•°è°ƒç”¨ã€å®ï¼Œç”šè‡³æ²¡æœ‰ `let` è¯­å¥â€”â€”åªæœ‰æ•°å­— `5` æœ¬èº«ã€‚è¿™åœ¨ Rust ä¸­æ˜¯ä¸€ä¸ªå®Œå…¨æœ‰æ•ˆçš„å‡½æ•°ã€‚æ³¨æ„ï¼Œå‡½æ•°è¿”å›å€¼çš„ç±»å‹ä¹Ÿè¢«æŒ‡å®šå¥½ï¼Œå³ `-> i32`ã€‚

`five` å‡½æ•°çš„è¿”å›å€¼æ˜¯ `5`ï¼Œæ‰€ä»¥è¿”å›å€¼ç±»å‹æ˜¯ `i32`ã€‚è®©æˆ‘ä»¬ä»”ç»†æ£€æŸ¥ä¸€ä¸‹è¿™æ®µä»£ç ã€‚æœ‰ä¸¤ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼šé¦–å…ˆï¼Œ`let x = five();` è¿™ä¸€è¡Œè¡¨æ˜æˆ‘ä»¬ä½¿ç”¨å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ–ä¸€ä¸ªå˜é‡ã€‚å› ä¸º `five` å‡½æ•°è¿”å› `5`ï¼Œè¿™ä¸€è¡Œä¸å¦‚ä¸‹ä»£ç ç›¸åŒï¼š

```rust
let x = 5;
```

å…¶æ¬¡ï¼Œ`five` å‡½æ•°æ²¡æœ‰å‚æ•°å¹¶å®šä¹‰äº†è¿”å›å€¼ç±»å‹ï¼Œä¸è¿‡å‡½æ•°ä½“åªæœ‰å•å•ä¸€ä¸ª `5` ä¹Ÿæ²¡æœ‰åˆ†å·ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæ­£æ˜¯æˆ‘ä»¬æƒ³è¦è¿”å›çš„å€¼ã€‚

```rust
// å¦ä¸€ä¸ªä¾‹å­
fn main() {
    let x = plus_one(5);

    println!("The value of x is: {}", x);
}

fn plus_one(x: i32) -> i32 {
    x + 1
}

// è¿è¡Œä»£ç ä¼šæ‰“å°å‡º The value of x is: 6ã€‚ä½†å¦‚æœåœ¨åŒ…å« x + 1 çš„è¡Œå°¾åŠ ä¸Šä¸€ä¸ªåˆ†å·ï¼ŒæŠŠå®ƒä»è¡¨è¾¾å¼å˜æˆè¯­å¥ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼š error[E0308]: mismatched types
```

ä¸»è¦çš„é”™è¯¯ä¿¡æ¯ â€œ**mismatched types**â€ï¼ˆ**ç±»å‹ä¸åŒ¹é…**ï¼‰æ­ç¤ºäº†è¿™æ®µä»£ç çš„æ ¸å¿ƒé—®é¢˜ã€‚å‡½æ•° `plus_one` çš„å®šä¹‰è¯´æ˜å®ƒè¦è¿”å›ä¸€ä¸ª `i32` ç±»å‹çš„å€¼ï¼Œä¸è¿‡è¯­å¥å¹¶ä¸ä¼šè¿”å›å€¼ï¼Œæ­¤å€¼ç”±å•ä½ç±»å‹ `()` è¡¨ç¤ºï¼Œè¡¨ç¤ºä¸è¿”å›å€¼ã€‚å› ä¸ºä¸è¿”å›å€¼ä¸å‡½æ•°å®šä¹‰ç›¸çŸ›ç›¾ï¼Œä»è€Œå‡ºç°ä¸€ä¸ªé”™è¯¯ã€‚åœ¨è¾“å‡ºä¸­ï¼ŒRust æä¾›äº†ä¸€æ¡ä¿¡æ¯ï¼Œå¯èƒ½æœ‰åŠ©äºçº æ­£è¿™ä¸ªé”™è¯¯ï¼šå®ƒå»ºè®®åˆ é™¤åˆ†å·ï¼Œè¿™å°†ä¿®å¤é”™è¯¯ã€‚



## æ§åˆ¶æµ

*Rust ä»£ç ä¸­æœ€å¸¸è§çš„ç”¨æ¥æ§åˆ¶æ‰§è¡Œæµçš„ç»“æ„æ˜¯ `if` è¡¨è¾¾å¼å’Œå¾ªç¯*ã€‚

### if è¡¨è¾¾å¼

`if` è¡¨è¾¾å¼å…è®¸æ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒçš„ä»£ç åˆ†æ”¯ã€‚

- true -> è¿è¡Œã€‚
- false -> ä¸è¿è¡Œã€‚
- ä»£ç ä¸­çš„æ¡ä»¶**å¿…é¡»**æ˜¯ `bool` å€¼ã€‚

```rust
fn main() {
    let number = 3;

    if number != 0 {
        println!("number was something other than zero");
    }
}

// è¿è¡Œä»£ç ä¼šæ‰“å°å‡º number was something other than zeroã€‚
```

#### ä½¿ç”¨else if å¤„ç†å¤šé‡æ¡ä»¶

```rust
fn main() {
    let number = 6;

    if number % 4 == 0 {
        println!("number is divisible by 4");
    } else if number % 3 == 0 {
        println!("number is divisible by 3");
    } else if number % 2 == 0 {
        println!("number is divisible by 2");
    } else {
        println!("number is not divisible by 4, 3, or 2");
    }
}

// è¿è¡Œä»£ç ä¼šæ‰“å°å‡º number is divisible by 3ã€‚
```

å½“æ‰§è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œå®ƒæŒ‰é¡ºåºæ£€æŸ¥æ¯ä¸ª `if` è¡¨è¾¾å¼å¹¶æ‰§è¡Œç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºçœŸçš„ä»£ç å—ã€‚æ³¨æ„å³ä½¿ 6 å¯ä»¥è¢« 2 æ•´é™¤ï¼Œä¹Ÿä¸ä¼šè¾“å‡º `number is divisible by 2`ï¼Œæ›´ä¸ä¼šè¾“å‡º `else` å—ä¸­çš„ `number is not divisible by 4, 3, or 2`ã€‚åŸå› æ˜¯ **Rust åªä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºçœŸçš„ä»£ç å—**ï¼Œå¹¶ä¸”ä¸€æ—¦å®ƒæ‰¾åˆ°ä¸€ä¸ªä»¥åï¼Œç”šè‡³éƒ½ä¸ä¼šæ£€æŸ¥å‰©ä¸‹çš„æ¡ä»¶äº†ã€‚

#### åœ¨ let è¯­å¥ä¸­ä½¿ç”¨ if

å› ä¸º `if` æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `let` è¯­å¥çš„å³ä¾§ä½¿ç”¨å®ƒæ¥å°†ç»“æœèµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚**ä»£ç å—çš„å€¼æ˜¯å…¶æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œè€Œæ•°å­—æœ¬èº«å°±æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼**ï¼Œæ•´ä¸ª `if` è¡¨è¾¾å¼çš„å€¼å–å†³äºå“ªä¸ªä»£ç å—è¢«æ‰§è¡Œã€‚è¿™æ„å‘³ç€ `if` çš„æ¯ä¸ªåˆ†æ”¯çš„å¯èƒ½çš„è¿”å›å€¼éƒ½å¿…é¡»æ˜¯**ç›¸åŒç±»å‹**ã€‚

```rust
fn main() {
    let condition = true;
    let number = if condition { 5 } else { 6 };

    println!("The value of number is: {}", number);
}

// è¿è¡Œä»£ç ä¼šæ‰“å°å‡º The value of number is: 5ã€‚
```

#### ä½¿ç”¨å¾ªç¯é‡å¤æ‰§è¡Œ

*å¤šæ¬¡æ‰§è¡ŒåŒä¸€æ®µä»£ç æ˜¯å¾ˆå¸¸ç”¨çš„ï¼ŒRust ä¸ºæ­¤æä¾›äº†å¤šç§**å¾ªç¯**ï¼ˆ*loop*ï¼‰ï¼Œå®ƒä»¬éå†æ‰§è¡Œå¾ªç¯ä½“ä¸­çš„ä»£ç ç›´åˆ°ç»“å°¾å¹¶ç´§æ¥ç€å›åˆ°å¼€å¤´ç»§ç»­æ‰§è¡Œã€‚*

- `loop`
- `while`
- `for`

##### ä½¿ç”¨loopé‡å¤æ‰§è¡Œä»£ç 

`loop` å…³é”®å­—å‘Šè¯‰ Rust ä¸€éåˆä¸€éåœ°æ‰§è¡Œä¸€æ®µä»£ç ç›´åˆ°ä½ æ˜ç¡®è¦æ±‚åœæ­¢ã€‚

```rust
fn main() {
    loop {
        println!("again!");
    }
}

// å½“è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿ç»­çš„åå¤æ‰“å° again!
```

-  `break` å…³é”®å­—æ¥å‘Šè¯‰ç¨‹åºä½•æ—¶åœæ­¢å¾ªç¯ã€‚
- `continue`å…³é”®å­—å‘Šè¯‰ç¨‹åºè·³è¿‡è¿™ä¸ªå¾ªç¯è¿­ä»£ä¸­çš„ä»»ä½•å‰©ä½™ä»£ç ï¼Œå¹¶è½¬åˆ°ä¸‹ä¸€ä¸ªè¿­ä»£ã€‚

å¦‚æœå­˜åœ¨åµŒå¥—å¾ªç¯ï¼Œ`break` å’Œ `continue` åº”ç”¨äºæ­¤æ—¶æœ€å†…å±‚çš„å¾ªç¯ã€‚ä½ å¯ä»¥é€‰æ‹©åœ¨ä¸€ä¸ªå¾ªç¯ä¸ŠæŒ‡å®šä¸€ä¸ª**å¾ªç¯æ ‡ç­¾**ï¼ˆ*loop label*ï¼‰ï¼Œç„¶åå°†æ ‡ç­¾ä¸ `break` æˆ– `continue` ä¸€èµ·ä½¿ç”¨ï¼Œä½¿è¿™äº›å…³é”®å­—åº”ç”¨äºå·²æ ‡è®°çš„å¾ªç¯è€Œä¸æ˜¯æœ€å†…å±‚çš„å¾ªç¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªåµŒå¥—å¾ªç¯çš„ç¤ºä¾‹ï¼š

```rust
fn main() {
    let mut count = 0;
    'counting_up: loop {
        println!("count = {}", count);
        let mut remaining = 10;

        loop {
            println!("remaining = {}", remaining);
            if remaining == 9 {
                break;
            }
            if count == 2 {
                break 'counting_up;
            }
            remaining -= 1;
        }

        count += 1;
    }
    println!("End count = {}", count);
}

```

å¤–å±‚å¾ªç¯æœ‰ä¸€ä¸ªæ ‡ç­¾ `counting_up`ï¼Œå®ƒå°†ä» 0 æ•°åˆ° 2ã€‚æ²¡æœ‰æ ‡ç­¾çš„å†…éƒ¨å¾ªç¯ä» 10 å‘ä¸‹æ•°åˆ° 9ã€‚ç¬¬ä¸€ä¸ªæ²¡æœ‰æŒ‡å®šæ ‡ç­¾çš„ `break` å°†åªé€€å‡ºå†…å±‚å¾ªç¯ã€‚`break 'counting_up;` è¯­å¥å°†é€€å‡ºå¤–å±‚å¾ªç¯ã€‚è¿™ä¸ªä»£ç æ‰“å°ï¼š

```sh
$ cargo run
   Compiling loops v0.1.0 (file:///projects/loops)
    Finished dev [unoptimized + debuginfo] target(s) in 0.58s
     Running `target/debug/loops`
count = 0
remaining = 10
remaining = 9
count = 1
remaining = 10
remaining = 9
count = 2
remaining = 10
End count = 2
```

##### ä»å¾ªç¯è¿”å›

`loop` çš„ä¸€ä¸ªç”¨ä¾‹æ˜¯é‡è¯•å¯èƒ½ä¼šå¤±è´¥çš„æ“ä½œï¼Œæ¯”å¦‚æ£€æŸ¥çº¿ç¨‹æ˜¯å¦å®Œæˆäº†ä»»åŠ¡ã€‚ç„¶è€Œä½ å¯èƒ½ä¼šéœ€è¦å°†æ“ä½œçš„ç»“æœä»å¾ªç¯ä¸­ä¼ é€’ç»™å…¶å®ƒçš„ä»£ç ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥åœ¨ç”¨äºåœæ­¢å¾ªç¯çš„ `break` è¡¨è¾¾å¼æ·»åŠ ä½ æƒ³è¦è¿”å›çš„å€¼ï¼›è¯¥å€¼å°†ä»å¾ªç¯ä¸­è¿”å›ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```rust
fn main() {
    let mut counter = 0;

    let result = loop {
        counter += 1;

        if counter == 10 {
            break counter * 2;
        }
    };

    println!("The result is {}", result);
}

// è¿è¡Œä»£ç ä¼šæ‰“å°å‡º The result is: 20ã€‚
```

åœ¨å¾ªç¯ä¹‹å‰ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªåä¸º `counter` çš„å˜é‡å¹¶åˆå§‹åŒ–ä¸º `0`ã€‚æ¥ç€å£°æ˜äº†ä¸€ä¸ªåä¸º `result` æ¥å­˜æ”¾å¾ªç¯çš„è¿”å›å€¼ã€‚åœ¨å¾ªç¯çš„æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°† `counter` å˜é‡åŠ  `1`ï¼Œæ¥ç€æ£€æŸ¥è®¡æ•°æ˜¯å¦ç­‰äº `10`ã€‚å½“ç›¸ç­‰æ—¶ï¼Œä½¿ç”¨ `break` å…³é”®å­—è¿”å›å€¼ `counter * 2`ã€‚å¾ªç¯ä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡åˆ†å·ç»“æŸèµ‹å€¼ç»™ `result` çš„è¯­å¥ã€‚æœ€åæ‰“å°å‡º `result` çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ 20ã€‚

### whileæ¡ä»¶å¾ªç¯

è¿™ç§ç»“æ„æ¶ˆé™¤äº†å¾ˆå¤šä½¿ç”¨ `loop`ã€`if`ã€`else` å’Œ `break` æ—¶æ‰€å¿…é¡»çš„åµŒå¥—ï¼Œè¿™æ ·æ›´åŠ æ¸…æ™°ã€‚**å½“æ¡ä»¶ä¸ºçœŸå°±æ‰§è¡Œï¼Œå¦åˆ™é€€å‡ºå¾ªç¯**ã€‚

```rust
// ç¤ºä¾‹ 3-3
fn main() {
    let mut number = 3;

    while number != 0 {
        println!("{}!", number);

        number -= 1;
    }

    println!("LIFTOFF!!!");
}
```

å¯ä»¥ä½¿ç”¨ `while` ç»“æ„æ¥éå†é›†åˆä¸­çš„å…ƒç´ ï¼Œæ¯”å¦‚æ•°ç»„ã€‚å¾ªç¯æ‰“å°æ•°ç»„ `a` ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```rust
// ç¤ºä¾‹ 3-4
fn main() {
    let a = [10, 20, 30, 40, 50];
    let mut index = 0;

    while index < 5 {
        println!("the value is: {}", a[index]);

        index += 1;
    }
}
```

åœ¨è¿™é‡Œï¼Œä»£ç å¯¹æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œè®¡æ•°ã€‚å®ƒä»ç´¢å¼• `0` å¼€å§‹ï¼Œå¹¶æ¥ç€å¾ªç¯ç›´åˆ°é‡åˆ°æ•°ç»„çš„æœ€åä¸€ä¸ªç´¢å¼•ï¼ˆå³ `index < 5` ä¸å†ä¸ºçœŸæ—¶ï¼‰ã€‚è¿è¡Œè¿™æ®µä»£ç ä¼šæ‰“å°å‡ºæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼š

```sh
$ cargo run
   Compiling loops v0.1.0 (file:///projects/loops)
    Finished dev [unoptimized + debuginfo] target(s) in 0.32s
     Running `target/debug/loops`
the value is: 10
the value is: 20
the value is: 30
the value is: 40
the value is: 50
```

æ•°ç»„ä¸­çš„ 5 ä¸ªå…ƒç´ å…¨éƒ¨éƒ½å¦‚æœŸè¢«æ‰“å°å‡ºæ¥ã€‚å°½ç®¡ `index` åœ¨æŸä¸€æ—¶åˆ»ä¼šåˆ°è¾¾å€¼ `5`ï¼Œä¸è¿‡å¾ªç¯åœ¨å…¶å°è¯•ä»æ•°ç»„è·å–ç¬¬ 6 ä¸ªå€¼ï¼ˆä¼šè¶Šç•Œï¼‰ä¹‹å‰å°±åœæ­¢äº†ã€‚ä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹å¾ˆå®¹æ˜“å‡ºé”™ï¼›å¦‚æœç´¢å¼•å€¼æˆ–æµ‹è¯•æ¡ä»¶ä¸æ­£ç¡®ä¼šå¯¼è‡´ç¨‹åº panicã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°† `a` æ•°ç»„çš„å®šä¹‰æ›´æ”¹ä¸ºåŒ…å« 4 ä¸ªå…ƒç´ ï¼Œä½†å¿˜è®°å°†æ¡ä»¶æ›´æ–°ä¸º`while index < 4`ï¼Œåˆ™ä»£ç ä¼šå‡ºç° panicã€‚è¿™ä¹Ÿä½¿ç¨‹åºæ›´æ…¢ï¼Œå› ä¸ºç¼–è¯‘å™¨å¢åŠ äº†è¿è¡Œæ—¶ä»£ç æ¥å¯¹æ¯æ¬¡å¾ªç¯è¿›è¡Œæ¡ä»¶æ£€æŸ¥ï¼Œä»¥ç¡®å®šåœ¨å¾ªç¯çš„æ¯æ¬¡è¿­ä»£ä¸­ç´¢å¼•æ˜¯å¦åœ¨æ•°ç»„çš„è¾¹ç•Œå†…ã€‚`for` å¾ªç¯æ¥å¯¹ä¸€ä¸ªé›†åˆçš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€äº›ä»£ç æ˜¯æ›´ç®€æ´çš„æ›¿ä»£æ–¹æ¡ˆã€‚

### foréå†é›†åˆ

```rust
// ä½¿ç”¨ for å¾ªç¯éå†é›†åˆä¸­çš„å…ƒç´ 
fn main() {
    let a = [10, 20, 30, 40, 50];

    for element in a {
        println!("the value is: {}", element);
    }
}
```

å½“è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼Œå°†çœ‹åˆ°ä¸ç¤ºä¾‹ 3-4 ä¸€æ ·çš„è¾“å‡ºã€‚æ›´ä¸ºé‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å¢å¼ºäº†ä»£ç å®‰å…¨æ€§ï¼Œå¹¶æ¶ˆé™¤äº†å¯èƒ½ç”±äºè¶…å‡ºæ•°ç»„çš„ç»“å°¾æˆ–éå†é•¿åº¦ä¸å¤Ÿè€Œç¼ºå°‘ä¸€äº›å…ƒç´ è€Œå¯¼è‡´çš„ bugã€‚ä½¿ç”¨ `for` å¾ªç¯çš„è¯ï¼Œå°±ä¸éœ€è¦æƒ¦è®°ç€åœ¨æ”¹å˜æ•°ç»„å…ƒç´ ä¸ªæ•°æ—¶ä¿®æ”¹å…¶ä»–çš„ä»£ç äº†ï¼Œå°±åƒä½¿ç”¨ç¤ºä¾‹ 3-4 ä¸­ä½¿ç”¨çš„æ–¹æ³•ä¸€æ ·ã€‚`for` å¾ªç¯çš„å®‰å…¨æ€§å’Œç®€æ´æ€§ä½¿å¾—å®ƒæˆä¸º Rust ä¸­ä½¿ç”¨æœ€å¤šçš„å¾ªç¯ç»“æ„ã€‚å³ä½¿æ˜¯åœ¨æƒ³è¦å¾ªç¯æ‰§è¡Œä»£ç ç‰¹å®šæ¬¡æ•°æ—¶ï¼Œä¾‹å¦‚ç¤ºä¾‹ 3-3 ä¸­ä½¿ç”¨ `while` å¾ªç¯çš„å€’è®¡æ—¶ä¾‹å­ï¼Œå¤§éƒ¨åˆ† Rustacean ä¹Ÿä¼šä½¿ç”¨ `for` å¾ªç¯ã€‚è¿™ä¹ˆåšçš„æ–¹å¼æ˜¯ä½¿ç”¨ `Range`ï¼Œå®ƒæ˜¯æ ‡å‡†åº“æä¾›çš„ç±»å‹ï¼Œç”¨æ¥ç”Ÿæˆä»ä¸€ä¸ªæ•°å­—å¼€å§‹åˆ°å¦ä¸€ä¸ªæ•°å­—ä¹‹å‰ç»“æŸçš„æ‰€æœ‰æ•°å­—çš„åºåˆ—ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ `for` å¾ªç¯æ¥å€’è®¡æ—¶çš„ä¾‹å­ï¼Œå®ƒè¿˜ä½¿ç”¨äº†ä¸€ä¸ªæˆ‘ä»¬è¿˜æœªè®²åˆ°çš„æ–¹æ³•ï¼Œ`rev`ï¼Œç”¨æ¥åè½¬åŒºé—´ï¼ˆrangeï¼‰:

```rust
// è¿™æ®µä»£ç æ›´å¥½ä¸€äº›ï¼Œä¸æ˜¯å—ï¼Ÿ
fn main() {
    for number in (1..4).rev() {
        println!("{}!", number);
    }
    println!("LIFTOFF!!!");
}
```



## æ‰€æœ‰æƒ

Rust çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆä¹‹ä¸€ï¼‰æ˜¯ **æ‰€æœ‰æƒ**ï¼ˆ*ownership*ï¼‰ã€‚è™½ç„¶è¯¥åŠŸèƒ½å¾ˆå®¹æ˜“è§£é‡Šï¼Œä½†å®ƒå¯¹è¯­è¨€çš„å…¶ä»–éƒ¨åˆ†æœ‰ç€æ·±åˆ»çš„å½±å“ã€‚æ‰€æœ‰è¿è¡Œçš„ç¨‹åºéƒ½å¿…é¡»ç®¡ç†å…¶ä½¿ç”¨è®¡ç®—æœºå†…å­˜çš„æ–¹å¼ã€‚ä¸€äº›è¯­è¨€ä¸­å…·æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ä¸æ–­åœ°å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼›åœ¨å¦ä¸€äº›è¯­è¨€ä¸­ï¼Œå¼€å‘è€…å¿…é¡»äº²è‡ªåˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚Rust åˆ™é€‰æ‹©äº†ç¬¬ä¸‰ç§æ–¹å¼ï¼šé€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿç®¡ç†å†…å­˜ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šæ ¹æ®ä¸€ç³»åˆ—çš„è§„åˆ™è¿›è¡Œæ£€æŸ¥ã€‚åœ¨è¿è¡Œæ—¶ï¼Œæ‰€æœ‰æƒç³»ç»Ÿçš„ä»»ä½•åŠŸèƒ½éƒ½ä¸ä¼šå‡æ…¢ç¨‹åºã€‚

**æ ˆï¼ˆStackï¼‰ ä¸å †ï¼ˆHeapï¼‰**

```matlab
åœ¨å¾ˆå¤šè¯­è¨€ä¸­ï¼Œä½ å¹¶ä¸éœ€è¦ç»å¸¸è€ƒè™‘åˆ°æ ˆä¸å †ã€‚ä¸è¿‡åœ¨åƒ Rust è¿™æ ·çš„ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå€¼æ˜¯ä½äºæ ˆä¸Šè¿˜æ˜¯å †ä¸Šåœ¨æ›´å¤§ç¨‹åº¦ä¸Šå½±å“äº†è¯­è¨€çš„è¡Œä¸ºä»¥åŠä¸ºä½•å¿…é¡»åšå‡ºè¿™æ ·çš„æŠ‰æ‹©ã€‚æˆ‘ä»¬ä¼šåœ¨æœ¬ç« çš„ç¨åéƒ¨åˆ†æè¿°æ‰€æœ‰æƒä¸æ ˆå’Œå †ç›¸å…³çš„å†…å®¹ï¼Œæ‰€ä»¥è¿™é‡Œåªæ˜¯ä¸€ä¸ªç”¨æ¥é¢„çƒ­çš„ç®€è¦è§£é‡Šã€‚

æ ˆå’Œå †éƒ½æ˜¯ä»£ç åœ¨è¿è¡Œæ—¶å¯ä¾›ä½¿ç”¨çš„å†…å­˜ï¼Œä½†æ˜¯å®ƒä»¬çš„ç»“æ„ä¸åŒã€‚æ ˆä»¥æ”¾å…¥å€¼çš„é¡ºåºå­˜å‚¨å€¼å¹¶ä»¥ç›¸åé¡ºåºå–å‡ºå€¼ã€‚è¿™ä¹Ÿè¢«ç§°ä½œ åè¿›å…ˆå‡ºï¼ˆlast in, first outï¼‰ã€‚æƒ³è±¡ä¸€ä¸‹ä¸€å ç›˜å­ï¼šå½“å¢åŠ æ›´å¤šç›˜å­æ—¶ï¼ŒæŠŠå®ƒä»¬æ”¾åœ¨ç›˜å­å †çš„é¡¶éƒ¨ï¼Œå½“éœ€è¦ç›˜å­æ—¶ï¼Œä¹Ÿä»é¡¶éƒ¨æ‹¿èµ°ã€‚ä¸èƒ½ä»ä¸­é—´ä¹Ÿä¸èƒ½ä»åº•éƒ¨å¢åŠ æˆ–æ‹¿èµ°ç›˜å­ï¼å¢åŠ æ•°æ®å«åš è¿›æ ˆï¼ˆpushing onto the stackï¼‰ï¼Œè€Œç§»å‡ºæ•°æ®å«åš å‡ºæ ˆï¼ˆpopping off the stackï¼‰ã€‚

æ ˆä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»å ç”¨å·²çŸ¥ä¸”å›ºå®šçš„å¤§å°ã€‚åœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥æˆ–å¤§å°å¯èƒ½å˜åŒ–çš„æ•°æ®ï¼Œè¦æ”¹ä¸ºå­˜å‚¨åœ¨å †ä¸Šã€‚å †æ˜¯ç¼ºä¹ç»„ç»‡çš„ï¼šå½“å‘å †æ”¾å…¥æ•°æ®æ—¶ï¼Œä½ è¦è¯·æ±‚ä¸€å®šå¤§å°çš„ç©ºé—´ã€‚å†…å­˜åˆ†é…å™¨ï¼ˆmemory allocatorï¼‰åœ¨å †çš„æŸå¤„æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºä½ï¼ŒæŠŠå®ƒæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä½ç½®åœ°å€çš„ æŒ‡é’ˆï¼ˆpointerï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä½œ åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼ˆallocating on the heapï¼‰ï¼Œæœ‰æ—¶ç®€ç§°ä¸º â€œåˆ†é…â€ï¼ˆallocatingï¼‰ã€‚å°†æ•°æ®æ¨å…¥æ ˆä¸­å¹¶ä¸è¢«è®¤ä¸ºæ˜¯åˆ†é…ã€‚å› ä¸ºæŒ‡é’ˆçš„å¤§å°æ˜¯å·²çŸ¥å¹¶ä¸”å›ºå®šçš„ï¼Œä½ å¯ä»¥å°†æŒ‡é’ˆå­˜å‚¨åœ¨æ ˆä¸Šï¼Œä¸è¿‡å½“éœ€è¦å®é™…æ•°æ®æ—¶ï¼Œå¿…é¡»è®¿é—®æŒ‡é’ˆã€‚

æƒ³è±¡ä¸€ä¸‹å»é¤é¦†å°±åº§åƒé¥­ã€‚å½“è¿›å…¥æ—¶ï¼Œä½ è¯´æ˜æœ‰å‡ ä¸ªäººï¼Œé¤é¦†å‘˜å·¥ä¼šæ‰¾åˆ°ä¸€ä¸ªå¤Ÿå¤§çš„ç©ºæ¡Œå­å¹¶é¢†ä½ ä»¬è¿‡å»ã€‚å¦‚æœæœ‰äººæ¥è¿Ÿäº†ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¯¢é—®æ¥æ‰¾åˆ°ä½ ä»¬ååœ¨å“ªã€‚

å…¥æ ˆæ¯”åœ¨å †ä¸Šåˆ†é…å†…å­˜è¦å¿«ï¼Œå› ä¸ºï¼ˆå…¥æ ˆæ—¶ï¼‰åˆ†é…å™¨æ— éœ€ä¸ºå­˜å‚¨æ–°æ•°æ®å»æœç´¢å†…å­˜ç©ºé—´ï¼›å…¶ä½ç½®æ€»æ˜¯åœ¨æ ˆé¡¶ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨å †ä¸Šåˆ†é…å†…å­˜åˆ™éœ€è¦æ›´å¤šçš„å·¥ä½œï¼Œè¿™æ˜¯å› ä¸ºåˆ†é…å™¨å¿…é¡»é¦–å…ˆæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå­˜æ”¾æ•°æ®çš„å†…å­˜ç©ºé—´ï¼Œå¹¶æ¥ç€åšä¸€äº›è®°å½•ä¸ºä¸‹ä¸€æ¬¡åˆ†é…åšå‡†å¤‡ã€‚

è®¿é—®å †ä¸Šçš„æ•°æ®æ¯”è®¿é—®æ ˆä¸Šçš„æ•°æ®æ…¢ï¼Œå› ä¸ºå¿…é¡»é€šè¿‡æŒ‡é’ˆæ¥è®¿é—®ã€‚ç°ä»£å¤„ç†å™¨åœ¨å†…å­˜ä¸­è·³è½¬è¶Šå°‘å°±è¶Šå¿«ï¼ˆç¼“å­˜ï¼‰ã€‚ç»§ç»­ç±»æ¯”ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæœåŠ¡å‘˜åœ¨é¤å…é‡Œå¤„ç†å¤šä¸ªæ¡Œå­çš„ç‚¹èœã€‚åœ¨ä¸€ä¸ªæ¡Œå­æŠ¥å®Œæ‰€æœ‰èœåå†ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ¡Œå­æ˜¯æœ€æœ‰æ•ˆç‡çš„ã€‚ä»æ¡Œå­ A å¬ä¸€ä¸ªèœï¼Œæ¥ç€æ¡Œå­ B å¬ä¸€ä¸ªèœï¼Œç„¶åå†æ¡Œå­ Aï¼Œç„¶åå†æ¡Œå­ B è¿™æ ·çš„æµç¨‹ä¼šæ›´åŠ ç¼“æ…¢ã€‚å‡ºäºåŒæ ·åŸå› ï¼Œå¤„ç†å™¨åœ¨å¤„ç†çš„æ•°æ®å½¼æ­¤è¾ƒè¿‘çš„æ—¶å€™ï¼ˆæ¯”å¦‚åœ¨æ ˆä¸Šï¼‰æ¯”è¾ƒè¿œçš„æ—¶å€™ï¼ˆæ¯”å¦‚å¯èƒ½åœ¨å †ä¸Šï¼‰èƒ½æ›´å¥½çš„å·¥ä½œã€‚åœ¨å †ä¸Šåˆ†é…å¤§é‡çš„ç©ºé—´ä¹Ÿå¯èƒ½æ¶ˆè€—æ—¶é—´ã€‚

å½“ä½ çš„ä»£ç è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼ é€’ç»™å‡½æ•°çš„å€¼ï¼ˆåŒ…æ‹¬å¯èƒ½æŒ‡å‘å †ä¸Šæ•°æ®çš„æŒ‡é’ˆï¼‰å’Œå‡½æ•°çš„å±€éƒ¨å˜é‡è¢«å‹å…¥æ ˆä¸­ã€‚å½“å‡½æ•°ç»“æŸæ—¶ï¼Œè¿™äº›å€¼è¢«ç§»å‡ºæ ˆã€‚

è·Ÿè¸ªå“ªéƒ¨åˆ†ä»£ç æ­£åœ¨ä½¿ç”¨å †ä¸Šçš„å“ªäº›æ•°æ®ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘å †ä¸Šçš„é‡å¤æ•°æ®é‡ï¼Œä»¥åŠæ¸…ç†å †ä¸Šä¸å†ä½¿ç”¨çš„æ•°æ®ç¡®ä¿ä¸ä¼šè€—å°½ç©ºé—´ï¼Œè¿™äº›é—®é¢˜æ­£æ˜¯æ‰€æœ‰æƒç³»ç»Ÿè¦å¤„ç†çš„ã€‚ä¸€æ—¦ç†è§£äº†æ‰€æœ‰æƒï¼Œä½ å°±ä¸éœ€è¦ç»å¸¸è€ƒè™‘æ ˆå’Œå †äº†ï¼Œä¸è¿‡æ˜ç™½äº†æ‰€æœ‰æƒçš„å­˜åœ¨å°±æ˜¯ä¸ºäº†ç®¡ç†å †æ•°æ®ï¼Œèƒ½å¤Ÿå¸®åŠ©è§£é‡Šä¸ºä»€ä¹ˆæ‰€æœ‰æƒè¦ä»¥è¿™ç§æ–¹å¼å·¥ä½œã€‚
```

#### æ‰€æœ‰æƒè§„åˆ™

- Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªè¢«ç§°ä¸ºå…¶ **æ‰€æœ‰è€…**ï¼ˆ*owner*ï¼‰çš„å˜é‡ã€‚
- å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚
- å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒã€‚

##### å˜é‡ä½œç”¨åŸŸ

åœ¨æ‰€æœ‰æƒçš„ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹çœ‹ä¸€äº›å˜é‡çš„ **ä½œç”¨åŸŸ**ï¼ˆ*scope*ï¼‰ã€‚ä½œç”¨åŸŸæ˜¯ä¸€ä¸ªé¡¹ï¼ˆitemï¼‰åœ¨ç¨‹åºä¸­æœ‰æ•ˆçš„èŒƒå›´ã€‚å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªå˜é‡ï¼š

```rust
let s = "hello";
```

å˜é‡ `s` ç»‘å®šåˆ°äº†ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å€¼æ˜¯ç¡¬ç¼–ç è¿›ç¨‹åºä»£ç ä¸­çš„ã€‚è¯¥å˜é‡ä»å£°æ˜çš„é‚£ä¸€åˆ»å¼€å§‹ç›´åˆ°å½“å‰ **ä½œç”¨åŸŸ** ç»“æŸæ—¶éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ç¤ºä¾‹ 4-1 çš„æ³¨é‡Šæ ‡æ˜äº†å˜é‡ `s` çš„æœ‰æ•ˆèŒƒå›´ã€‚

```rust
// ä¸€ä¸ªå˜é‡å’Œå…¶æœ‰æ•ˆçš„ä½œç”¨åŸŸ
fn main() {
    {                      // s åœ¨è¿™é‡Œæ— æ•ˆ, å®ƒå°šæœªå£°æ˜
        let s = "hello";   // ä»æ­¤å¤„èµ·ï¼Œs å¼€å§‹æœ‰æ•ˆ

        // ä½¿ç”¨ s
    }                      // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œs ä¸å†æœ‰æ•ˆ
}
```

æ¢å¥è¯è¯´ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ—¶é—´ç‚¹ï¼š

- å½“ `s` **è¿›å…¥ä½œç”¨åŸŸ** æ—¶ï¼Œå®ƒå°±æ˜¯æœ‰æ•ˆçš„ã€‚
- è¿™ä¸€ç›´æŒç»­åˆ°å®ƒ **ç¦»å¼€ä½œç”¨åŸŸ** ä¸ºæ­¢ã€‚

ç›®å‰ä¸ºæ­¢ï¼Œå˜é‡æ˜¯å¦æœ‰æ•ˆä¸ä½œç”¨åŸŸçš„å…³ç³»è·Ÿå…¶ä»–ç¼–ç¨‹è¯­è¨€æ˜¯ç±»ä¼¼çš„ã€‚ç°åœ¨æˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šä»‹ç» `String` ç±»å‹ã€‚

###### Stringç±»å‹

å‰é¢ä»‹ç»çš„ç±»å‹éƒ½æ˜¯å·²çŸ¥å¤§å°çš„ï¼Œå¯ä»¥å­˜å‚¨åœ¨æ ˆä¸­ï¼Œå¹¶ä¸”å½“ç¦»å¼€ä½œç”¨åŸŸæ—¶è¢«ç§»å‡ºæ ˆï¼Œå¦‚æœä»£ç çš„å¦ä¸€éƒ¨åˆ†éœ€è¦åœ¨ä¸åŒçš„ä½œç”¨åŸŸä¸­ä½¿ç”¨ç›¸åŒçš„å€¼ï¼Œå¯ä»¥å¿«é€Ÿç®€å•åœ°å¤åˆ¶å®ƒä»¬æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç‹¬ç«‹å®ä¾‹ã€‚ä¸è¿‡æˆ‘ä»¬éœ€è¦å¯»æ‰¾ä¸€ä¸ªå­˜å‚¨åœ¨å †ä¸Šçš„æ•°æ®æ¥æ¢ç´¢ Rust æ˜¯å¦‚ä½•çŸ¥é“è¯¥åœ¨ä½•æ—¶æ¸…ç†æ•°æ®çš„ã€‚

è¿™é‡Œä½¿ç”¨ `String` ä½œä¸ºä¾‹å­ï¼Œå¹¶ä¸“æ³¨äº `String` ä¸æ‰€æœ‰æƒç›¸å…³çš„éƒ¨åˆ†ã€‚è¿™äº›æ–¹é¢ä¹ŸåŒæ ·é€‚ç”¨äºæ ‡å‡†åº“æä¾›çš„æˆ–ä½ è‡ªå·±åˆ›å»ºçš„å…¶ä»–å¤æ‚æ•°æ®ç±»å‹ã€‚

æˆ‘ä»¬å·²ç»è§è¿‡å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå³è¢«ç¡¬ç¼–ç è¿›ç¨‹åºé‡Œçš„å­—ç¬¦ä¸²å€¼ã€‚å­—ç¬¦ä¸²å­—é¢é‡æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä¸è¿‡å®ƒä»¬å¹¶ä¸é€‚åˆä½¿ç”¨æ–‡æœ¬çš„æ¯ä¸€ç§åœºæ™¯ã€‚åŸå› ä¹‹ä¸€å°±æ˜¯å®ƒä»¬æ˜¯ä¸å¯å˜çš„ã€‚å¦ä¸€ä¸ªåŸå› æ˜¯å¹¶éæ‰€æœ‰å­—ç¬¦ä¸²çš„å€¼éƒ½èƒ½åœ¨ç¼–å†™ä»£ç æ—¶å°±çŸ¥é“ï¼šä¾‹å¦‚ï¼Œè¦æ˜¯æƒ³è·å–ç”¨æˆ·è¾“å…¥å¹¶å­˜å‚¨è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä¸ºæ­¤ï¼ŒRust æœ‰ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œ`String`ã€‚è¿™ä¸ªç±»å‹ç®¡ç†è¢«åˆ†é…åˆ°å †ä¸Šçš„æ•°æ®ï¼Œæ‰€ä»¥èƒ½å¤Ÿå­˜å‚¨åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„æ–‡æœ¬ã€‚å¯ä»¥ä½¿ç”¨ `from` å‡½æ•°åŸºäºå­—ç¬¦ä¸²å­—é¢é‡æ¥åˆ›å»º `String`ï¼Œå¦‚ä¸‹ï¼š

```rust
let s = String::from("hello");
```

è¿™ä¸¤ä¸ªå†’å·ï¼ˆ`::`ï¼‰æ˜¯è¿ç®—ç¬¦ï¼Œå…è®¸å°†ç‰¹å®šçš„ `from` å‡½æ•°ç½®äº `String` ç±»å‹çš„å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ä¸‹ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ç±»ä¼¼ `string_from` è¿™æ ·çš„åå­—ã€‚

**å¯ä»¥** ä¿®æ”¹æ­¤ç±»å­—ç¬¦ä¸² ï¼š

```rust
    let mut s = String::from("hello");

    s.push_str(", world!"); // push_str() åœ¨å­—ç¬¦ä¸²åè¿½åŠ å­—é¢å€¼

    println!("{}", s); // å°†æ‰“å° `hello, world!`
```

ä¸ºä»€ä¹ˆ `String` å¯å˜è€Œå­—é¢é‡å´ä¸è¡Œå‘¢ï¼ŸåŒºåˆ«åœ¨äºä¸¤ä¸ªç±»å‹å¯¹å†…å­˜çš„å¤„ç†ä¸Šã€‚

#### å†…å­˜ä¸åˆ†é…

å°±å­—ç¬¦ä¸²å­—é¢é‡æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å…¶å†…å®¹ï¼Œæ‰€ä»¥æ–‡æœ¬è¢«ç›´æ¥ç¡¬ç¼–ç è¿›æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚è¿™ä½¿å¾—å­—ç¬¦ä¸²å­—é¢é‡å¿«é€Ÿä¸”é«˜æ•ˆã€‚ä¸è¿‡è¿™äº›ç‰¹æ€§éƒ½åªå¾—ç›Šäºå­—ç¬¦ä¸²å­—é¢é‡çš„ä¸å¯å˜æ€§ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸ºäº†æ¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ–‡æœ¬è€Œå°†ä¸€å—å†…å­˜æ”¾å…¥äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å®ƒçš„å¤§å°è¿˜å¯èƒ½éšç€ç¨‹åºè¿è¡Œè€Œæ”¹å˜ã€‚

å¯¹äº `String` ç±»å‹ï¼Œä¸ºäº†æ”¯æŒä¸€ä¸ªå¯å˜ï¼Œå¯å¢é•¿çš„æ–‡æœ¬ç‰‡æ®µï¼Œéœ€è¦åœ¨å †ä¸Šåˆ†é…ä¸€å—åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„å†…å­˜æ¥å­˜æ”¾å†…å®¹ã€‚è¿™æ„å‘³ç€ï¼š

- å¿…é¡»åœ¨è¿è¡Œæ—¶å‘å†…å­˜åˆ†é…å™¨è¯·æ±‚å†…å­˜ã€‚
- éœ€è¦ä¸€ä¸ªå½“æˆ‘ä»¬å¤„ç†å®Œ `String` æ—¶å°†å†…å­˜è¿”å›ç»™åˆ†é…å™¨çš„æ–¹æ³•ã€‚

ç¬¬ä¸€éƒ¨åˆ†ç”±æˆ‘ä»¬å®Œæˆï¼šå½“è°ƒç”¨ `String::from` æ—¶ï¼Œå®ƒçš„å®ç°ï¼ˆ*implementation*ï¼‰è¯·æ±‚å…¶æ‰€éœ€çš„å†…å­˜ã€‚è¿™åœ¨ç¼–ç¨‹è¯­è¨€ä¸­æ˜¯éå¸¸é€šç”¨çš„ã€‚

ç„¶è€Œï¼Œç¬¬äºŒéƒ¨åˆ†å®ç°èµ·æ¥å°±å„æœ‰åŒºåˆ«äº†ã€‚åœ¨æœ‰ **åƒåœ¾å›æ”¶**ï¼ˆ*garbage collector*ï¼Œ*GC*ï¼‰çš„è¯­è¨€ä¸­ï¼Œ GC è®°å½•å¹¶æ¸…é™¤ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œè€Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å…³å¿ƒå®ƒã€‚æ²¡æœ‰ GC çš„è¯ï¼Œè¯†åˆ«å‡ºä¸å†ä½¿ç”¨çš„å†…å­˜å¹¶è°ƒç”¨ä»£ç æ˜¾å¼é‡Šæ”¾å°±æ˜¯æˆ‘ä»¬çš„è´£ä»»äº†ï¼Œè·Ÿè¯·æ±‚å†…å­˜çš„æ—¶å€™ä¸€æ ·ã€‚ä»å†å²çš„è§’åº¦ä¸Šè¯´æ­£ç¡®å¤„ç†å†…å­˜å›æ”¶æ›¾ç»æ˜¯ä¸€ä¸ªå›°éš¾çš„ç¼–ç¨‹é—®é¢˜ã€‚å¦‚æœå¿˜è®°å›æ”¶äº†ä¼šæµªè´¹å†…å­˜ã€‚å¦‚æœè¿‡æ—©å›æ”¶äº†ï¼Œå°†ä¼šå‡ºç°æ— æ•ˆå˜é‡ã€‚å¦‚æœé‡å¤å›æ”¶ï¼Œè¿™ä¹Ÿæ˜¯ä¸ª bugã€‚æˆ‘ä»¬éœ€è¦ç²¾ç¡®åœ°ä¸ºä¸€ä¸ª `allocate` é…å¯¹ä¸€ä¸ª `free`ã€‚

Rust é‡‡å–äº†ä¸€ä¸ªä¸åŒçš„ç­–ç•¥ï¼šå†…å­˜åœ¨æ‹¥æœ‰å®ƒçš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸåå°±è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚ä¸‹é¢æ˜¯ç¤ºä¾‹ 4-1 ä¸­ä½œç”¨åŸŸä¾‹å­çš„ä¸€ä¸ªä½¿ç”¨ `String` è€Œä¸æ˜¯å­—ç¬¦ä¸²å­—é¢é‡çš„ç‰ˆæœ¬ï¼š

```rust
fn main() {
    {
        let s = String::from("hello"); // ä»æ­¤å¤„èµ·ï¼Œs å¼€å§‹æœ‰æ•ˆ

        // ä½¿ç”¨ s
    }                                  // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œ
                                       // s ä¸å†æœ‰æ•ˆ
}
```

*æ³¨æ„ï¼šåœ¨ C++ ä¸­ï¼Œè¿™ç§ item åœ¨ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶é‡Šæ”¾èµ„æºçš„æ¨¡å¼æœ‰æ—¶è¢«ç§°ä½œ **èµ„æºè·å–å³åˆå§‹åŒ–**ï¼ˆ*Resource Acquisition Is Initialization (RAII)*ï¼‰ã€‚å¦‚æœä½ ä½¿ç”¨è¿‡ RAII æ¨¡å¼çš„è¯åº”è¯¥å¯¹ Rust çš„ `drop` å‡½æ•°å¹¶ä¸é™Œç”Ÿã€‚*

è¿™æ˜¯ä¸€ä¸ªå°† `String` éœ€è¦çš„å†…å­˜è¿”å›ç»™åˆ†é…å™¨çš„å¾ˆè‡ªç„¶çš„ä½ç½®ï¼šå½“ `s` ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™ã€‚å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼ŒRust ä¸ºæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å«åš [`drop`](https://rustwiki.org/zh-CN/std/ops/trait.Drop.html#tymethod.drop)ï¼Œåœ¨è¿™é‡Œ `String` çš„ä½œè€…å¯ä»¥æ”¾ç½®é‡Šæ”¾å†…å­˜çš„ä»£ç ã€‚Rust åœ¨ç»“å°¾çš„ `}` å¤„è‡ªåŠ¨è°ƒç”¨ `drop`ã€‚è¿™ä¸ªæ¨¡å¼å¯¹ç¼–å†™ Rust ä»£ç çš„æ–¹å¼æœ‰ç€æ·±è¿œçš„å½±å“ã€‚ç°åœ¨å®ƒçœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä¸è¿‡åœ¨æ›´å¤æ‚çš„åœºæ™¯ä¸‹ä»£ç çš„è¡Œä¸ºå¯èƒ½æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œæ¯”å¦‚å½“æœ‰å¤šä¸ªå˜é‡ä½¿ç”¨åœ¨å †ä¸Šåˆ†é…çš„å†…å­˜æ—¶ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¢ç´¢ä¸€äº›è¿™æ ·çš„åœºæ™¯ã€‚

##### å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼ï¼ˆä¸€ï¼‰ï¼šç§»åŠ¨

åœ¨ Rust ä¸­ï¼Œå¤šä¸ªå˜é‡èƒ½å¤Ÿä»¥ä¸åŒçš„æ–¹å¼ä¸åŒä¸€æ•°æ®äº¤äº’ã€‚

```rust
// å°†å˜é‡ x çš„æ•´æ•°å€¼èµ‹ç»™ y
fn main() {
    let x = 5;
    let y = x;
}
```

æˆ‘ä»¬å¤§è‡´å¯ä»¥çŒœåˆ°è¿™åœ¨å¹²ä»€ä¹ˆï¼šâ€œå°† `5` ç»‘å®šåˆ° `x`ï¼›æ¥ç€ç”Ÿæˆä¸€ä¸ªå€¼ `x` çš„æ‹·è´å¹¶ç»‘å®šåˆ° `y`â€ã€‚ç°åœ¨æœ‰äº†ä¸¤ä¸ªå˜é‡ï¼Œ`x` å’Œ `y`ï¼Œéƒ½ç­‰äº `5`ã€‚è¿™ä¹Ÿæ­£æ˜¯äº‹å®ä¸Šå‘ç”Ÿäº†çš„ï¼Œå› ä¸ºæ•´æ•°æ˜¯æœ‰å·²çŸ¥å›ºå®šå¤§å°çš„ç®€å•å€¼ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ª `5` è¢«æ”¾å…¥äº†æ ˆï¼ˆstackï¼‰ä¸­ã€‚

ç°åœ¨çœ‹çœ‹è¿™ä¸ª `String` ç‰ˆæœ¬ï¼š

```rust
fn main() {
    let s1 = String::from("hello");
    let s2 = s1;
}
```

è¿™çœ‹èµ·æ¥ä¸ä¸Šé¢çš„ä»£ç éå¸¸ç±»ä¼¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯èƒ½ä¼šå‡è®¾ä»–ä»¬çš„è¿è¡Œæ–¹å¼ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬äºŒè¡Œå¯èƒ½ä¼šç”Ÿæˆä¸€ä¸ª `s1` çš„æ‹·è´å¹¶ç»‘å®šåˆ° `s2` ä¸Šã€‚ä¸è¿‡ï¼Œäº‹å®ä¸Šå¹¶ä¸å®Œå…¨æ˜¯è¿™æ ·ã€‚çœ‹çœ‹å›¾ 4-1 ä»¥äº†è§£ `String` çš„åº•å±‚ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

`String` ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå¦‚å›¾å·¦ä¾§æ‰€ç¤ºï¼šä¸€ä¸ªæŒ‡å‘å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹å†…å­˜çš„æŒ‡é’ˆï¼Œä¸€ä¸ªé•¿åº¦ï¼Œå’Œä¸€ä¸ªå®¹é‡ã€‚è¿™ä¸€ç»„æ•°æ®å­˜å‚¨åœ¨æ ˆä¸Šã€‚å³ä¾§åˆ™æ˜¯å †ä¸Šå­˜æ”¾å†…å®¹çš„å†…å­˜éƒ¨åˆ†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

![String in memory](https://rustwiki.org/zh-CN/book/img/trpl04-01.svg)

å›¾ 4-1ï¼šå°†å€¼ `"hello"` ç»‘å®šç»™ `s1` çš„ `String` åœ¨å†…å­˜ä¸­çš„è¡¨ç°å½¢å¼

é•¿åº¦è¡¨ç¤º `String` çš„å†…å®¹å½“å‰ä½¿ç”¨äº†å¤šå°‘å­—èŠ‚çš„å†…å­˜ã€‚å®¹é‡æ˜¯ `String` ä»åˆ†é…å™¨æ€»å…±è·å–äº†å¤šå°‘å­—èŠ‚çš„å†…å­˜ã€‚é•¿åº¦ä¸å®¹é‡çš„åŒºåˆ«æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸è¿‡åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­å¹¶ä¸é‡è¦ï¼Œæ‰€ä»¥ç°åœ¨å¯ä»¥å¿½ç•¥å®¹é‡ã€‚

å½“æˆ‘ä»¬å°† `s1` èµ‹å€¼ç»™ `s2`ï¼Œ`String` çš„æ•°æ®è¢«å¤åˆ¶äº†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä»æ ˆä¸Šæ‹·è´äº†å®ƒçš„æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰å¤åˆ¶æŒ‡é’ˆæŒ‡å‘çš„å †ä¸Šæ•°æ®ã€‚æ¢å¥è¯è¯´ï¼Œå†…å­˜ä¸­æ•°æ®çš„è¡¨ç°å¦‚å›¾ 4-2 æ‰€ç¤ºã€‚

![s1 and s2 pointing to the same value](https://rustwiki.org/zh-CN/book/img/trpl04-02.svg)

å›¾ 4-2ï¼šå˜é‡ `s2` çš„å†…å­˜è¡¨ç°ï¼Œå®ƒæœ‰ä¸€ä»½ `s1` æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡çš„æ‹·è´

è¿™ä¸ªè¡¨ç°å½¢å¼çœ‹èµ·æ¥ **å¹¶ä¸åƒ** å›¾ 4-3 ä¸­çš„é‚£æ ·ï¼Œå¦‚æœ Rust ä¹Ÿæ‹·è´äº†å †ä¸Šçš„æ•°æ®ï¼Œé‚£ä¹ˆå†…å­˜çœ‹èµ·æ¥å°±æ˜¯è¿™æ ·çš„ã€‚å¦‚æœ Rust è¿™ä¹ˆåšäº†ï¼Œé‚£ä¹ˆæ“ä½œ `s2 = s1` åœ¨å †ä¸Šæ•°æ®æ¯”è¾ƒå¤§çš„æ—¶å€™ä¼šå¯¹è¿è¡Œæ—¶æ€§èƒ½é€ æˆéå¸¸å¤§çš„å½±å“ã€‚

![s1 and s2 to two places](https://rustwiki.org/zh-CN/book/img/trpl04-03.svg)

å›¾ 4-3ï¼šå¦ä¸€ä¸ª `s2 = s1` æ—¶å¯èƒ½çš„å†…å­˜è¡¨ç°ï¼Œå¦‚æœ Rust åŒæ—¶ä¹Ÿæ‹·è´äº†å †ä¸Šçš„æ•°æ®çš„è¯

ä¹‹å‰æˆ‘ä»¬æåˆ°è¿‡å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸåï¼ŒRust è‡ªåŠ¨è°ƒç”¨ `drop` å‡½æ•°å¹¶æ¸…ç†å˜é‡çš„å †å†…å­˜ã€‚ä¸è¿‡å›¾ 4-2 å±•ç¤ºäº†ä¸¤ä¸ªæ•°æ®æŒ‡é’ˆæŒ‡å‘äº†åŒä¸€ä½ç½®ã€‚è¿™å°±æœ‰äº†ä¸€ä¸ªé—®é¢˜ï¼šå½“ `s2` å’Œ `s1` ç¦»å¼€ä½œç”¨åŸŸï¼Œä»–ä»¬éƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„å†…å­˜ã€‚è¿™æ˜¯ä¸€ä¸ªå«åš **äºŒæ¬¡é‡Šæ”¾**ï¼ˆ*double free*ï¼‰çš„é”™è¯¯ï¼Œä¹Ÿæ˜¯ä¹‹å‰æåˆ°è¿‡çš„å†…å­˜å®‰å…¨æ€§ bug ä¹‹ä¸€ã€‚ä¸¤æ¬¡é‡Šæ”¾ï¼ˆç›¸åŒï¼‰å†…å­˜ä¼šå¯¼è‡´å†…å­˜æ±¡æŸ“ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚

ä¸ºäº†ç¡®ä¿å†…å­˜å®‰å…¨ï¼Œè¿™ç§åœºæ™¯ä¸‹ Rust çš„å¤„ç†æœ‰å¦ä¸€ä¸ªç»†èŠ‚å€¼å¾—æ³¨æ„ã€‚åœ¨ `let s2 = s1` ä¹‹åï¼ŒRust è®¤ä¸º `s1` ä¸å†æœ‰æ•ˆï¼Œå› æ­¤ Rust ä¸éœ€è¦åœ¨ `s1` ç¦»å¼€ä½œç”¨åŸŸåæ¸…ç†ä»»ä½•ä¸œè¥¿ã€‚çœ‹çœ‹åœ¨ `s2` è¢«åˆ›å»ºä¹‹åå°è¯•ä½¿ç”¨ `s1` ä¼šå‘ç”Ÿä»€ä¹ˆï¼›è¿™æ®µä»£ç ä¸èƒ½è¿è¡Œï¼š

```rust
fn main() {
    let s1 = String::from("hello");
    let s2 = s1;

    println!("{}, world!", s1);
}

// ä»£ç è¿è¡Œæ—¶ï¼Œå°†ä¼šäº§ç”Ÿé”™è¯¯ï¼šerror[E0382]: borrow of moved value: `s1`ï¼Œï¼Œå› ä¸º Rust ç¦æ­¢ä½ ä½¿ç”¨æ— æ•ˆçš„å¼•ç”¨ã€‚
```

å¦‚æœä½ åœ¨å…¶ä»–è¯­è¨€ä¸­å¬è¯´è¿‡æœ¯è¯­ **æµ…æ‹·è´**ï¼ˆ*shallow copy*ï¼‰å’Œ **æ·±æ‹·è´**ï¼ˆ*deep copy*ï¼‰ï¼Œé‚£ä¹ˆæ‹·è´æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡è€Œä¸æ‹·è´æ•°æ®å¯èƒ½å¬èµ·æ¥åƒæµ…æ‹·è´ã€‚ä¸è¿‡å› ä¸º Rust åŒæ—¶ä½¿ç¬¬ä¸€ä¸ªå˜é‡æ— æ•ˆäº†ï¼Œè¿™ä¸ªæ“ä½œè¢«ç§°ä¸º **ç§»åŠ¨**ï¼ˆ*move*ï¼‰ï¼Œè€Œä¸æ˜¯æµ…æ‹·è´ã€‚ä¸Šé¢çš„ä¾‹å­å¯ä»¥è§£è¯»ä¸º `s1` è¢« **ç§»åŠ¨** åˆ°äº† `s2` ä¸­ã€‚é‚£ä¹ˆå…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œå¦‚å›¾ 4-4 æ‰€ç¤ºã€‚

![s1 moved to s2](https://rustwiki.org/zh-CN/book/img/trpl04-04.svg)

å›¾ 4-4ï¼š`s1` æ— æ•ˆä¹‹åçš„å†…å­˜è¡¨ç°

è¿™æ ·å°±è§£å†³äº†æˆ‘ä»¬çš„é—®é¢˜ï¼å› ä¸ºåªæœ‰ `s2` æ˜¯æœ‰æ•ˆçš„ï¼Œå½“å…¶ç¦»å¼€ä½œç”¨åŸŸï¼Œå®ƒå°±é‡Šæ”¾è‡ªå·±çš„å†…å­˜ï¼Œå®Œæ¯•ã€‚

å¦å¤–ï¼Œè¿™é‡Œè¿˜éšå«äº†ä¸€ä¸ªè®¾è®¡é€‰æ‹©ï¼šRust æ°¸è¿œä¹Ÿä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„ â€œæ·±æ‹·è´â€ã€‚å› æ­¤ï¼Œä»»ä½• **è‡ªåŠ¨** çš„å¤åˆ¶å¯ä»¥è¢«è®¤ä¸ºå¯¹è¿è¡Œæ—¶æ€§èƒ½å½±å“è¾ƒå°ã€‚

##### å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼ï¼ˆäºŒï¼‰ï¼šå…‹éš†

å¦‚æœæˆ‘ä»¬ **ç¡®å®** éœ€è¦æ·±åº¦å¤åˆ¶ `String` ä¸­å †ä¸Šçš„æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯æ ˆä¸Šçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åš `clone` çš„é€šç”¨å‡½æ•°ã€‚ç¬¬ 5 ç« ä¼šè®¨è®ºæ–¹æ³•è¯­æ³•ï¼Œä¸è¿‡å› ä¸ºæ–¹æ³•åœ¨å¾ˆå¤šè¯­è¨€ä¸­æ˜¯ä¸€ä¸ªå¸¸è§åŠŸèƒ½ï¼Œæ‰€ä»¥ä¹‹å‰ä½ å¯èƒ½å·²ç»è§è¿‡äº†ã€‚

```rust
// è¿™æ˜¯ä¸€ä¸ªå®é™…ä½¿ç”¨ `clone` æ–¹æ³•çš„ä¾‹å­
fn main() {
    let s1 = String::from("hello");
    let s2 = s1.clone();

    println!("s1 = {}, s2 = {}", s1, s2);
}
```

è¿™æ®µä»£ç èƒ½æ­£å¸¸è¿è¡Œï¼Œå¹¶ä¸”æ˜ç¡®äº§ç”Ÿå›¾ 4-3 ä¸­è¡Œä¸ºï¼Œè¿™é‡Œå †ä¸Šçš„æ•°æ® **ç¡®å®** è¢«å¤åˆ¶äº†ã€‚

å½“å‡ºç° `clone` è°ƒç”¨æ—¶ï¼Œä½ çŸ¥é“ä¸€äº›ç‰¹å®šçš„ä»£ç è¢«æ‰§è¡Œè€Œä¸”è¿™äº›ä»£ç å¯èƒ½ç›¸å½“æ¶ˆè€—èµ„æºã€‚ä½ å¾ˆå®¹æ˜“å¯Ÿè§‰åˆ°ä¸€äº›ä¸å¯»å¸¸çš„äº‹æƒ…æ­£åœ¨å‘ç”Ÿã€‚

##### åªåœ¨æ ˆä¸Šçš„æ•°æ®ï¼šæ‹·è´

è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ²¡æœ‰æåˆ°çš„å°çªé—¨ã€‚è¿™äº›ä»£ç ä½¿ç”¨äº†æ•´å‹å¹¶ä¸”æ˜¯æœ‰æ•ˆçš„ï¼Œä»–ä»¬æ˜¯ç¤ºä¾‹ 4-2 ä¸­çš„ä¸€éƒ¨åˆ†ï¼š

```rust
fn main() {
    let x = 5;
    let y = x;

    println!("x = {}, y = {}", x, y);
}
```

ä½†è¿™æ®µä»£ç ä¼¼ä¹ä¸æˆ‘ä»¬åˆšåˆšå­¦åˆ°çš„å†…å®¹ç›¸çŸ›ç›¾ï¼šæ²¡æœ‰è°ƒç”¨ `clone`ï¼Œä¸è¿‡ `x` ä¾ç„¶æœ‰æ•ˆä¸”æ²¡æœ‰è¢«ç§»åŠ¨åˆ° `y` ä¸­ã€‚

åŸå› æ˜¯åƒæ•´å‹è¿™æ ·çš„**åœ¨ç¼–è¯‘æ—¶å·²çŸ¥å¤§å°çš„ç±»å‹è¢«æ•´ä¸ªå­˜å‚¨åœ¨æ ˆä¸Š**ï¼Œæ‰€ä»¥æ‹·è´å…¶å®é™…çš„å€¼æ˜¯å¿«é€Ÿçš„ã€‚è¿™æ„å‘³ç€æ²¡æœ‰ç†ç”±åœ¨åˆ›å»ºå˜é‡ `y` åä½¿ `x` æ— æ•ˆã€‚æ¢å¥è¯è¯´ï¼Œè¿™é‡Œæ²¡æœ‰æ·±æµ…æ‹·è´çš„åŒºåˆ«ï¼Œæ‰€ä»¥è¿™é‡Œè°ƒç”¨ `clone` å¹¶ä¸ä¼šä¸é€šå¸¸çš„æµ…æ‹·è´æœ‰ä»€ä¹ˆä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨ç®¡å®ƒã€‚

Rust æœ‰ä¸€ä¸ªå«åš `Copy` trait çš„ç‰¹æ®Šæ ‡æ³¨ï¼Œå¯ä»¥ç”¨åœ¨ç±»ä¼¼æ•´å‹è¿™æ ·çš„å­˜å‚¨åœ¨æ ˆä¸Šçš„ç±»å‹ä¸Šã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† `Copy` traitï¼Œé‚£ä¹ˆä¸€ä¸ªæ—§çš„å˜é‡åœ¨å°†å…¶èµ‹å€¼ç»™å…¶ä»–å˜é‡åä»ç„¶å¯ç”¨ã€‚Rust ä¸å…è®¸è‡ªèº«æˆ–å…¶ä»»ä½•éƒ¨åˆ†å®ç°äº† `Drop` trait çš„ç±»å‹ä½¿ç”¨ `Copy` traitã€‚å¦‚æœæˆ‘ä»¬å¯¹å…¶å€¼ç¦»å¼€ä½œç”¨åŸŸæ—¶éœ€è¦ç‰¹æ®Šå¤„ç†çš„ç±»å‹ä½¿ç”¨ `Copy` æ ‡æ³¨ï¼Œå°†ä¼šå‡ºç°ä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚

é‚£ä¹ˆå“ªäº›ç±»å‹å®ç°äº† `Copy` trait å‘¢ï¼Ÿä½ å¯ä»¥æŸ¥çœ‹ç»™å®šç±»å‹çš„æ–‡æ¡£æ¥ç¡®è®¤ï¼Œä¸è¿‡ä½œä¸ºä¸€ä¸ªé€šç”¨çš„è§„åˆ™ï¼Œä»»ä½•ä¸€ç»„ç®€å•æ ‡é‡å€¼çš„ç»„åˆéƒ½å¯ä»¥å®ç° `Copy`ï¼Œä»»ä½•ä¸éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§å½¢å¼èµ„æºçš„ç±»å‹éƒ½å¯ä»¥å®ç° `Copy` ã€‚å¦‚ä¸‹æ˜¯ä¸€äº› `Copy` çš„ç±»å‹ï¼š

- **æ‰€æœ‰æ•´æ•°ç±»å‹ï¼Œæ¯”å¦‚ `u32`**ã€‚
- **å¸ƒå°”ç±»å‹ï¼Œ`bool`ï¼Œå®ƒçš„å€¼æ˜¯ `true` å’Œ `false`**ã€‚
- **æ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹ï¼Œæ¯”å¦‚ `f64`**ã€‚
- **å­—ç¬¦ç±»å‹ï¼Œ`char`**ã€‚
- **å…ƒç»„ï¼Œå½“ä¸”ä»…å½“å…¶åŒ…å«çš„ç±»å‹ä¹Ÿéƒ½å®ç° `Copy` çš„æ—¶å€™ã€‚æ¯”å¦‚ï¼Œ`(i32, i32)` å®ç°äº† `Copy`ï¼Œä½† `(i32, String)` å°±æ²¡æœ‰**ã€‚

##### æ‰€æœ‰æƒä¸å‡½æ•°

å°†å€¼ä¼ é€’ç»™å‡½æ•°åœ¨è¯­ä¹‰ä¸Šä¸ç»™å˜é‡èµ‹å€¼ç›¸ä¼¼ã€‚å‘å‡½æ•°ä¼ é€’å€¼å¯èƒ½ä¼šç§»åŠ¨æˆ–è€…å¤åˆ¶ï¼Œå°±åƒèµ‹å€¼è¯­å¥ä¸€æ ·ã€‚ç¤ºä¾‹ 4-3 ä½¿ç”¨æ³¨é‡Šå±•ç¤ºå˜é‡ä½•æ—¶è¿›å…¥å’Œç¦»å¼€ä½œç”¨åŸŸï¼š

```rust
// ç¤ºä¾‹ 4-3ï¼šå¸¦æœ‰æ‰€æœ‰æƒå’Œä½œç”¨åŸŸæ³¨é‡Šçš„å‡½æ•°
fn main() {
  let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ

  takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                  // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ

  let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ

  makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ
                                  // ä½† i32 æ˜¯ Copy çš„ï¼Œæ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x

} // è¿™é‡Œ, x å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ
  // æ‰€ä»¥ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ

fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
  println!("{}", some_string);
} // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾

fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
  println!("{}", some_integer);
} // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ
```

å½“å°è¯•åœ¨è°ƒç”¨ `takes_ownership` åä½¿ç”¨ `s` æ—¶ï¼ŒRust ä¼šæŠ›å‡ºä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚è¿™äº›é™æ€æ£€æŸ¥ä½¿æˆ‘ä»¬å…äºçŠ¯é”™ã€‚è¯•è¯•åœ¨ `main` å‡½æ•°ä¸­æ·»åŠ ä½¿ç”¨ `s` å’Œ `x` çš„ä»£ç æ¥çœ‹çœ‹å“ªé‡Œèƒ½ä½¿ç”¨ä»–ä»¬ï¼Œä»¥åŠæ‰€æœ‰æƒè§„åˆ™ä¼šåœ¨å“ªé‡Œé˜»æ­¢æˆ‘ä»¬è¿™ä¹ˆåšã€‚

##### è¿”å›å€¼ä¸ä½œç”¨åŸŸ

è¿”å›å€¼ä¹Ÿå¯ä»¥è½¬ç§»æ‰€æœ‰æƒã€‚ç¤ºä¾‹ 4-4 ä¸ç¤ºä¾‹ 4-3 ä¸€æ ·å¸¦æœ‰ç±»ä¼¼çš„æ³¨é‡Šã€‚

```rust
// ç¤ºä¾‹ 4-4: è½¬ç§»è¿”å›å€¼çš„æ‰€æœ‰æƒ
fn main() {
  let s1 = gives_ownership();         // gives_ownership å°†è¿”å›å€¼
                                      // ç§»ç»™ s1

  let s2 = String::from("hello");     // s2 è¿›å…¥ä½œç”¨åŸŸ

  let s3 = takes_and_gives_back(s2);  // s2 è¢«ç§»åŠ¨åˆ°
                                      // takes_and_gives_back ä¸­,
                                      // å®ƒä¹Ÿå°†è¿”å›å€¼ç§»ç»™ s3
} // è¿™é‡Œ, s3 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚s2 ä¹Ÿç§»å‡ºä½œç”¨åŸŸï¼Œä½†å·²è¢«ç§»èµ°ï¼Œ
  // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚s1 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ

fn gives_ownership() -> String {           // gives_ownership å°†è¿”å›å€¼ç§»åŠ¨ç»™
                                           // è°ƒç”¨å®ƒçš„å‡½æ•°

  let some_string = String::from("yours"); // some_string è¿›å…¥ä½œç”¨åŸŸ

  some_string                              // è¿”å› some_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
}

// takes_and_gives_back å°†ä¼ å…¥å­—ç¬¦ä¸²å¹¶è¿”å›è¯¥å€¼
fn takes_and_gives_back(a_string: String) -> String { // a_string è¿›å…¥ä½œç”¨åŸŸ

  a_string  // è¿”å› a_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
}
```

å˜é‡çš„æ‰€æœ‰æƒæ€»æ˜¯éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š**å°†å€¼èµ‹ç»™å¦ä¸€ä¸ªå˜é‡æ—¶ç§»åŠ¨å®ƒã€‚å½“æŒæœ‰å †ä¸­æ•°æ®å€¼çš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå…¶å€¼å°†é€šè¿‡ `drop` è¢«æ¸…ç†æ‰ï¼Œé™¤éæ•°æ®è¢«ç§»åŠ¨ä¸ºå¦ä¸€ä¸ªå˜é‡æ‰€æœ‰**ã€‚

åœ¨æ¯ä¸€ä¸ªå‡½æ•°ä¸­éƒ½è·å–æ‰€æœ‰æƒå¹¶æ¥ç€è¿”å›æ‰€æœ‰æƒæœ‰äº›å•°å—¦ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å‡½æ•°ä½¿ç”¨ä¸€ä¸ªå€¼ä½†ä¸è·å–æ‰€æœ‰æƒè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬è¿˜è¦æ¥ç€ä½¿ç”¨å®ƒçš„è¯ï¼Œæ¯æ¬¡éƒ½ä¼ è¿›å»å†è¿”å›æ¥å°±æœ‰ç‚¹çƒ¦äººäº†ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯èƒ½æƒ³è¿”å›å‡½æ•°ä½“ä¸­äº§ç”Ÿçš„ä¸€äº›æ•°æ®ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…ƒç»„æ¥è¿”å›å¤šä¸ªå€¼ï¼Œå¦‚ç¤ºä¾‹ 4-5 æ‰€ç¤ºã€‚

```rust
// ç¤ºä¾‹ 4-5: è¿”å›å‚æ•°çš„æ‰€æœ‰æƒ
fn main() {
    let s1 = String::from("hello");

    let (s2, len) = calculate_length(s1);

    println!("The length of '{}' is {}.", s2, len);
}

fn calculate_length(s: String) -> (String, usize) {
    let length = s.len(); // len() è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦

    (s, length)
}
```

ä½†æ˜¯è¿™æœªå…æœ‰äº›å½¢å¼ä¸»ä¹‰ï¼Œè€Œä¸”è¿™ç§åœºæ™¯åº”è¯¥å¾ˆå¸¸è§ã€‚å¹¸è¿çš„æ˜¯ï¼ŒRust å¯¹æ­¤æä¾›äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œå«åš **å¼•ç”¨**ï¼ˆ*references*ï¼‰ã€‚

#### å¼•ç”¨

- åœ¨ä»»æ„ç»™å®šæ—¶é—´ï¼Œ**è¦ä¹ˆ** åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œ**è¦ä¹ˆ** åªèƒ½æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨ã€‚

- å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„ã€‚

  ![&String s pointing at String s1](https://rustwiki.org/zh-CN/book/img/trpl04-05.svg)

  ```rust
  fn main() {
      let s1 = String::from("hello");
  
      let len = calculate_length(&s1);
  
      println!("The length of '{}' is {}.", s1, len);
  }
  // å‡½æ•°ç­¾åä½¿ç”¨ & æ¥è¡¨æ˜å‚æ•° s çš„ç±»å‹æ˜¯ä¸€ä¸ªå¼•ç”¨
  fn calculate_length(s: &String) -> usize { // s æ˜¯å¯¹ String çš„å¼•ç”¨
      s.len()
  } // è¿™é‡Œï¼Œs ç¦»å¼€äº†ä½œç”¨åŸŸã€‚ä½†å› ä¸ºå®ƒå¹¶ä¸æ‹¥æœ‰å¼•ç”¨å€¼çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿ
  
  ```

  â€‹	`&s1` è¯­æ³•è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª **æŒ‡å‘** å€¼ `s1` çš„å¼•ç”¨ï¼Œä½†æ˜¯å¹¶ä¸æ‹¥æœ‰å®ƒã€‚å› ä¸ºå¹¶ä¸æ‹¥æœ‰è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥å½“å¼•ç”¨åœæ­¢ä½¿ç”¨æ—¶ï¼Œå®ƒæ‰€æŒ‡å‘çš„å€¼ä¹Ÿä¸ä¼šè¢«ä¸¢å¼ƒã€‚

  â€‹	å˜é‡ `s` æœ‰æ•ˆçš„ä½œç”¨åŸŸä¸å‡½æ•°å‚æ•°çš„ä½œç”¨åŸŸä¸€æ ·ï¼Œä¸è¿‡å½“å¼•ç”¨åœæ­¢ä½¿ç”¨æ—¶å¹¶ä¸ä¸¢å¼ƒå®ƒæŒ‡å‘çš„æ•°æ®ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰æ‰€æœ‰æƒã€‚å½“å‡½æ•°ä½¿ç”¨å¼•ç”¨è€Œä¸æ˜¯å®é™…å€¼ä½œä¸ºå‚æ•°ï¼Œæ— éœ€è¿”å›å€¼æ¥äº¤è¿˜æ‰€æœ‰æƒï¼Œå› ä¸ºå°±ä¸æ›¾æ‹¥æœ‰æ‰€æœ‰æƒã€‚

  â€‹	æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¼•ç”¨çš„è¡Œä¸ºç§°ä¸º **å€Ÿç”¨**ï¼ˆ*borrowing*ï¼‰ã€‚æ­£å¦‚ç°å®ç”Ÿæ´»ä¸­ï¼Œå¦‚æœä¸€ä¸ªäººæ‹¥æœ‰æŸæ ·ä¸œè¥¿ï¼Œä½ å¯ä»¥ä»ä»–é‚£é‡Œå€Ÿæ¥ã€‚å½“ä½ ä½¿ç”¨å®Œæ¯•ï¼Œå¿…é¡»è¿˜å›å»ã€‚

  #### å¯å˜å¼•ç”¨

  - åœ¨åŒä¸€æ—¶é—´ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå¯¹æŸä¸€ç‰¹å®šæ•°æ®çš„å¯å˜å¼•ç”¨ã€‚å°è¯•åˆ›å»ºä¸¤ä¸ªå¯å˜å¼•ç”¨çš„ä»£ç å°†ä¼šå¤±è´¥
  - ä¸èƒ½åœ¨æ‹¥æœ‰ä¸å¯å˜å¼•ç”¨çš„åŒæ—¶æ‹¥æœ‰å¯å˜å¼•ç”¨ã€‚
  - å¤šä¸ªä¸å¯å˜å¼•ç”¨æ˜¯å¯ä»¥çš„ã€‚

  ```rust
  fn main() {
      let mut s = String::from("hello");
  
      change(&mut s);
  }
  
  fn change(some_string: &mut String) {
      some_string.push_str(", world");
  }
  ```

  â€‹	é˜²æ­¢åŒä¸€æ—¶é—´å¯¹åŒä¸€æ•°æ®è¿›è¡Œå¤šä¸ªå¯å˜å¼•ç”¨çš„é™åˆ¶å…è®¸å¯å˜æ€§ï¼Œä¸è¿‡æ˜¯ä»¥ä¸€ç§å—é™åˆ¶çš„æ–¹å¼å…è®¸ã€‚æ–° Rustacean ä»¬ç»å¸¸éš¾ä»¥é€‚åº”è¿™ä¸€ç‚¹ï¼Œå› ä¸ºå¤§éƒ¨åˆ†è¯­è¨€ä¸­å˜é‡ä»»ä½•æ—¶å€™éƒ½æ˜¯å¯å˜çš„ã€‚è¿™ä¸ªé™åˆ¶çš„å¥½å¤„æ˜¯ Rust å¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±é¿å…æ•°æ®ç«äº‰ã€‚**æ•°æ®ç«äº‰**ï¼ˆ*data race*ï¼‰ç±»ä¼¼äºç«æ€æ¡ä»¶ï¼Œå®ƒç”±è¿™ä¸‰ä¸ªè¡Œä¸ºé€ æˆï¼š

  - ä¸¤ä¸ªæˆ–æ›´å¤šæŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€æ•°æ®ã€‚
  - è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆè¢«ç”¨æ¥å†™å…¥æ•°æ®ã€‚
  - æ²¡æœ‰åŒæ­¥æ•°æ®è®¿é—®çš„æœºåˆ¶ã€‚
  - è¯‘æ³¨ï¼šä»¥ä¸Šä¸‰ä¸ªè¡Œä¸º**åŒæ—¶å‘ç”Ÿ**æ‰ä¼šé€ æˆæ•°æ®ç«äº‰ï¼Œè€Œä¸æ˜¯å•ä¸€è¡Œä¸ºã€‚

  ä¸€å¦‚æ—¢å¾€ï¼Œå¯ä»¥ä½¿ç”¨å¤§æ‹¬å·æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œä»¥å…è®¸æ‹¥æœ‰å¤šä¸ªå¯å˜å¼•ç”¨ï¼Œåªæ˜¯ä¸èƒ½ **åŒæ—¶** æ‹¥æœ‰ï¼š

  ```rust
  fn main() {
      let mut s = String::from("hello");
  
      {
          let r1 = &mut s;
      } // r1 åœ¨è¿™é‡Œç¦»å¼€äº†ä½œç”¨åŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¼•ç”¨
  
      let r2 = &mut s;
  }
  ```

  â€‹	æ³¨æ„ä¸€ä¸ªå¼•ç”¨çš„ä½œç”¨åŸŸä»å£°æ˜çš„åœ°æ–¹å¼€å§‹ä¸€ç›´æŒç»­åˆ°æœ€åä¸€æ¬¡ä½¿ç”¨ä¸ºæ­¢ã€‚ä¾‹å¦‚ï¼Œå› ä¸ºæœ€åä¸€æ¬¡ä½¿ç”¨ä¸å¯å˜å¼•ç”¨ï¼ˆprintln!)ï¼Œå‘ç”Ÿåœ¨å£°æ˜å¯å˜å¼•ç”¨ä¹‹å‰ï¼Œæ‰€ä»¥å¦‚ä¸‹ä»£ç æ˜¯å¯ä»¥ç¼–è¯‘çš„:

  ```rust
  fn main() {
      let mut s = String::from("hello");
  
      let r1 = &s; // æ²¡é—®é¢˜
      let r2 = &s; // æ²¡é—®é¢˜
      println!("{} and {}", r1, r2);
      // æ­¤ä½ç½®ä¹‹å r1 å’Œ r2 ä¸å†ä½¿ç”¨
  
      let r3 = &mut s; // æ²¡é—®é¢˜
      println!("{}", r3);
  }
  ```

  â€‹	ä¸å¯å˜å¼•ç”¨ `r1` å’Œ `r2` çš„ä½œç”¨åŸŸåœ¨ `println!` æœ€åä¸€æ¬¡ä½¿ç”¨ä¹‹åç»“æŸï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºå¯å˜å¼•ç”¨ `r3` çš„åœ°æ–¹ã€‚å®ƒä»¬çš„ä½œç”¨åŸŸæ²¡æœ‰é‡å ï¼Œæ‰€ä»¥ä»£ç æ˜¯å¯ä»¥ç¼–è¯‘çš„ã€‚ç¼–è¯‘å™¨åœ¨ä½œç”¨åŸŸç»“æŸä¹‹å‰åˆ¤æ–­ä¸å†ä½¿ç”¨çš„å¼•ç”¨çš„èƒ½åŠ›è¢«ç§°ä¸ºéè¯æ³•ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸï¼ˆNon-Lexical Lifetimesï¼Œç®€ç§° NLLï¼‰ã€‚å°½ç®¡è¿™äº›é”™è¯¯æœ‰æ—¶ä½¿äººæ²®ä¸§ï¼Œä½†è¯·ç‰¢è®°è¿™æ˜¯ Rust ç¼–è¯‘å™¨åœ¨æå‰æŒ‡å‡ºä¸€ä¸ªæ½œåœ¨çš„ bugï¼ˆåœ¨ç¼–è¯‘æ—¶è€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ï¼‰å¹¶ç²¾å‡†æ˜¾ç¤ºé—®é¢˜æ‰€åœ¨ã€‚è¿™æ ·ä½ å°±ä¸å¿…å»è·Ÿè¸ªä¸ºä½•æ•°æ®å¹¶ä¸æ˜¯ä½ æƒ³è±¡ä¸­çš„é‚£æ ·ã€‚

  #### æ‚¬å‚å¼•ç”¨ï¼ˆDangling References)

  â€‹	åœ¨å…·æœ‰æŒ‡é’ˆçš„è¯­è¨€ä¸­ï¼Œå¾ˆå®¹æ˜“é€šè¿‡é‡Šæ”¾å†…å­˜æ—¶ä¿ç•™æŒ‡å‘å®ƒçš„æŒ‡é’ˆè€Œé”™è¯¯åœ°ç”Ÿæˆä¸€ä¸ª **æ‚¬å‚æŒ‡é’ˆ**ï¼ˆ*dangling pointer*ï¼‰ï¼Œæ‰€è°“æ‚¬å‚æŒ‡é’ˆæ˜¯å…¶æŒ‡å‘çš„å†…å­˜å¯èƒ½å·²ç»è¢«åˆ†é…ç»™å…¶å®ƒæŒæœ‰è€…ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨ Rust ä¸­ç¼–è¯‘å™¨ç¡®ä¿å¼•ç”¨æ°¸è¿œä¹Ÿä¸ä¼šå˜æˆæ‚¬å‚çŠ¶æ€ï¼šå½“ä½ æ‹¥æœ‰ä¸€äº›æ•°æ®çš„å¼•ç”¨ï¼Œç¼–è¯‘å™¨ç¡®ä¿æ•°æ®ä¸ä¼šåœ¨å…¶å¼•ç”¨ä¹‹å‰ç¦»å¼€ä½œç”¨åŸŸã€‚

  ```rust
  // è®©æˆ‘ä»¬å°è¯•åˆ›å»ºä¸€ä¸ªæ‚¬å‚å¼•ç”¨ï¼ŒRust ä¼šé€šè¿‡ä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯æ¥é¿å…ï¼š
  fn main() {
      let reference_to_nothing = dangle();
  }
  
  fn dangle() -> &String { // dangle è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼•ç”¨
  
      let s = String::from("hello"); // s æ˜¯ä¸€ä¸ªæ–°å­—ç¬¦ä¸²
  
      &s // è¿”å›å­—ç¬¦ä¸² s çš„å¼•ç”¨
  } // è¿™é‡Œ s ç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚å…¶å†…å­˜è¢«é‡Šæ”¾ã€‚
    // å±é™©ï¼
  ```

  â€‹	å› ä¸º `s` æ˜¯åœ¨ `dangle` å‡½æ•°å†…åˆ›å»ºçš„ï¼Œå½“ `dangle` çš„ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œ`s` å°†è¢«é‡Šæ”¾ã€‚ä¸è¿‡æˆ‘ä»¬å°è¯•è¿”å›å®ƒçš„å¼•ç”¨ã€‚è¿™æ„å‘³ç€è¿™ä¸ªå¼•ç”¨ä¼šæŒ‡å‘ä¸€ä¸ªæ— æ•ˆçš„ `String`ï¼Œè¿™å¯ä¸å¯¹ï¼Rust ä¸ä¼šå…è®¸æˆ‘ä»¬è¿™ä¹ˆåšã€‚è¿™é‡Œçš„è§£å†³æ–¹æ³•æ˜¯ç›´æ¥è¿”å› `String`ï¼š

  ```rust
  //è¿™æ ·å°±æ²¡æœ‰ä»»ä½•é”™è¯¯äº†ã€‚æ‰€æœ‰æƒè¢«ç§»åŠ¨å‡ºå»ï¼Œæ‰€ä»¥æ²¡æœ‰å€¼è¢«é‡Šæ”¾ã€‚
  fn main() {
      let string = no_dangle();
  }
  
  fn no_dangle() -> String {
      let s = String::from("hello");
  
      s
  }
  ```

#### åˆ‡ç‰‡Sliceç±»å‹

å¦ä¸€ä¸ªæ²¡æœ‰æ‰€æœ‰æƒçš„æ•°æ®ç±»å‹æ˜¯ *slice*ã€‚slice å…è®¸ä½ å¼•ç”¨é›†åˆä¸­ä¸€æ®µè¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸ç”¨å¼•ç”¨æ•´ä¸ªé›†åˆã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªç¼–ç¨‹å°ä¹ é¢˜ï¼šç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›åœ¨è¯¥å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå•è¯ã€‚å¦‚æœå‡½æ•°åœ¨è¯¥å­—ç¬¦ä¸²ä¸­å¹¶æœªæ‰¾åˆ°ç©ºæ ¼ï¼Œåˆ™æ•´ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸ªå•è¯ï¼Œæ‰€ä»¥åº”è¯¥è¿”å›æ•´ä¸ªå­—ç¬¦ä¸²ã€‚è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„ç­¾åï¼š

```rust
fn first_word(s: &String) -> ?
```

`first_word` å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•° `&String`ã€‚å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦æ‰€æœ‰æƒï¼Œæ‰€ä»¥è¿™æ²¡æœ‰é—®é¢˜ã€‚ä¸è¿‡åº”è¯¥è¿”å›ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¹¶æ²¡æœ‰ä¸€ä¸ªçœŸæ­£è·å– **éƒ¨åˆ†** å­—ç¬¦ä¸²çš„åŠæ³•ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›å•è¯ç»“å°¾çš„ç´¢å¼•ã€‚è¯•è¯•å¦‚ç¤ºä¾‹ 4-7 ä¸­çš„ä»£ç ã€‚

```rust
// ç¤ºä¾‹ 4-7ï¼šfirst_word å‡½æ•°è¿”å› String å‚æ•°çš„ä¸€ä¸ªå­—èŠ‚ç´¢å¼•å€¼
fn first_word(s: &String) -> usize {
    // å› ä¸ºéœ€è¦é€ä¸ªå…ƒç´ çš„æ£€æŸ¥ String ä¸­çš„å€¼æ˜¯å¦ä¸ºç©ºæ ¼ï¼Œéœ€è¦ç”¨ as_bytes æ–¹æ³•å°† String è½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼š
    let bytes = s.as_bytes();
    // æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ iter æ–¹æ³•åœ¨å­—èŠ‚æ•°ç»„ä¸Šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼š
    for (i, &item) in bytes.iter().enumerate() {
        // åœ¨ for å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å­—èŠ‚çš„å­—é¢é‡è¯­æ³•æ¥å¯»æ‰¾ä»£è¡¨ç©ºæ ¼çš„å­—èŠ‚ã€‚å¦‚æœæ‰¾åˆ°äº†ä¸€ä¸ªç©ºæ ¼ï¼Œè¿”å›å®ƒçš„ä½ç½®ã€‚
        if item == b' ' {
            return i;
        }
    }
    // å¦åˆ™ï¼Œä½¿ç”¨ s.len() è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦
    s.len()
}
```

`iter` æ–¹æ³•è¿”å›é›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œè€Œ `enumerate` åŒ…è£…äº† `iter` çš„ç»“æœï¼Œå°†è¿™äº›å…ƒç´ ä½œä¸ºå…ƒç»„çš„ä¸€éƒ¨åˆ†æ¥è¿”å›ã€‚`enumerate` è¿”å›çš„å…ƒç»„ä¸­ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ç´¢å¼•ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯é›†åˆä¸­å…ƒç´ çš„å¼•ç”¨ã€‚è¿™æ¯”æˆ‘ä»¬è‡ªå·±è®¡ç®—ç´¢å¼•è¦æ–¹ä¾¿ä¸€äº›ã€‚

å› ä¸º `enumerate` æ–¹æ³•è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼æ¥è§£æ„ã€‚æ‰€ä»¥åœ¨ `for` å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªæ¨¡å¼ï¼Œå…¶ä¸­å…ƒç»„ä¸­çš„ `i` æ˜¯ç´¢å¼•è€Œå…ƒç»„ä¸­çš„ `&item` æ˜¯å•ä¸ªå­—èŠ‚ã€‚å› ä¸ºæˆ‘ä»¬ä» `.iter().enumerate()` ä¸­è·å–äº†é›†åˆå…ƒç´ çš„å¼•ç”¨ï¼Œæ‰€ä»¥æ¨¡å¼ä¸­ä½¿ç”¨äº† `&`ã€‚

ç°åœ¨æœ‰äº†ä¸€ä¸ªæ‰¾åˆ°å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªå•è¯ç»“å°¾ç´¢å¼•çš„æ–¹æ³•ï¼Œä¸è¿‡è¿™æœ‰ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬è¿”å›äº†ä¸€ä¸ªç‹¬ç«‹çš„ `usize`ï¼Œä¸è¿‡å®ƒåªåœ¨ `&String` çš„ä¸Šä¸‹æ–‡ä¸­æ‰æ˜¯ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ•°å­—ã€‚æ¢å¥è¯è¯´ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªä¸ `String` ç›¸åˆ†ç¦»çš„å€¼ï¼Œæ— æ³•ä¿è¯å°†æ¥å®ƒä»ç„¶æœ‰æ•ˆã€‚è€ƒè™‘ä¸€ä¸‹ç¤ºä¾‹ 4-8 ä¸­ä½¿ç”¨äº†ç¤ºä¾‹ 4-7 ä¸­ `first_word` å‡½æ•°çš„ç¨‹åºã€‚

```rust
// ç¤ºä¾‹ 4-8ï¼šå­˜å‚¨ first_word å‡½æ•°è°ƒç”¨çš„è¿”å›å€¼å¹¶æ¥ç€æ”¹å˜ String çš„å†…å®¹
fn first_word(s: &String) -> usize {
    let bytes = s.as_bytes();

    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return i;
        }
    }

    s.len()
}

fn main() {
    let mut s = String::from("hello world");

    let word = first_word(&s); // word çš„å€¼ä¸º 5

    s.clear(); // è¿™æ¸…ç©ºäº†å­—ç¬¦ä¸²ï¼Œä½¿å…¶ç­‰äº ""

    // word åœ¨æ­¤å¤„çš„å€¼ä»ç„¶æ˜¯ 5ï¼Œ
    // ä½†æ˜¯æ²¡æœ‰æ›´å¤šçš„å­—ç¬¦ä¸²è®©æˆ‘ä»¬å¯ä»¥æœ‰æ•ˆåœ°åº”ç”¨æ•°å€¼ 5ã€‚word çš„å€¼ç°åœ¨å®Œå…¨æ— æ•ˆï¼
}
```

è¿™ä¸ªç¨‹åºç¼–è¯‘æ—¶æ²¡æœ‰ä»»ä½•é”™è¯¯ï¼Œè€Œä¸”åœ¨è°ƒç”¨ `s.clear()` ä¹‹åä½¿ç”¨ `word` ä¹Ÿä¸ä¼šå‡ºé”™ã€‚å› ä¸º `word` ä¸ `s` çŠ¶æ€å®Œå…¨æ²¡æœ‰è”ç³»ï¼Œæ‰€ä»¥ `word` ä»ç„¶åŒ…å«å€¼ `5`ã€‚å¯ä»¥å°è¯•ç”¨å€¼ `5` æ¥æå–å˜é‡ `s` çš„ç¬¬ä¸€ä¸ªå•è¯ï¼Œä¸è¿‡è¿™æ˜¯æœ‰ bug çš„ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬å°† `5` ä¿å­˜åˆ° `word` ä¹‹å `s` çš„å†…å®¹å·²ç»æ”¹å˜ã€‚æˆ‘ä»¬ä¸å¾—ä¸æ—¶åˆ»æ‹…å¿ƒ `word` çš„ç´¢å¼•ä¸ `s` ä¸­çš„æ•°æ®ä¸å†åŒæ­¥ï¼Œè¿™å¾ˆå•°å—¦ä¸”æ˜“å‡ºé”™ï¼å¦‚æœç¼–å†™è¿™ä¹ˆä¸€ä¸ª `second_word` å‡½æ•°çš„è¯ï¼Œç®¡ç†ç´¢å¼•è¿™ä»¶äº‹å°†æ›´åŠ å®¹æ˜“å‡ºé—®é¢˜ã€‚å®ƒçš„ç­¾åçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```rust
fn second_word(s: &String) -> (usize, usize) {
```

ç°åœ¨æˆ‘ä»¬è¦è·Ÿè¸ªä¸€ä¸ªå¼€å§‹ç´¢å¼• **å’Œ** ä¸€ä¸ªç»“å°¾ç´¢å¼•ï¼ŒåŒæ—¶æœ‰äº†æ›´å¤šä»æ•°æ®çš„æŸä¸ªç‰¹å®šçŠ¶æ€è®¡ç®—è€Œæ¥çš„å€¼ï¼Œä½†éƒ½å®Œå…¨æ²¡æœ‰ä¸è¿™ä¸ªçŠ¶æ€ç›¸å…³è”ã€‚ç°åœ¨æœ‰ä¸‰ä¸ªé£˜å¿½ä¸å®šçš„ä¸ç›¸å…³å˜é‡éœ€è¦ä¿æŒåŒæ­¥ã€‚å¹¸è¿çš„æ˜¯ï¼ŒRust ä¸ºè¿™ä¸ªé—®é¢˜æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ³•ï¼šå­—ç¬¦ä¸² sliceã€‚

##### **å­—ç¬¦ä¸² slice**

**å­—ç¬¦ä¸² slice**ï¼ˆ*string slice*ï¼‰æ˜¯ `String` ä¸­ä¸€éƒ¨åˆ†å€¼çš„å¼•ç”¨ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```rust
fn main() {
    let s = String::from("hello world");

    let hello = &s[0..5];
    let world = &s[6..11];
}
```

è¿™ç±»ä¼¼äºå¼•ç”¨æ•´ä¸ª `String` ä¸è¿‡å¸¦æœ‰é¢å¤–çš„ `[0..5]` éƒ¨åˆ†ã€‚å®ƒä¸æ˜¯å¯¹æ•´ä¸ª `String` çš„å¼•ç”¨ï¼Œè€Œæ˜¯å¯¹éƒ¨åˆ† `String` çš„å¼•ç”¨ã€‚

å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç”±ä¸­æ‹¬å·ä¸­çš„ `[starting_index..ending_index]` æŒ‡å®šçš„ range åˆ›å»ºä¸€ä¸ª sliceï¼Œå…¶ä¸­ `starting_index` æ˜¯ slice çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œ`ending_index` åˆ™æ˜¯ slice æœ€åä¸€ä¸ªä½ç½®çš„åä¸€ä¸ªå€¼ã€‚åœ¨å…¶å†…éƒ¨ï¼Œslice çš„æ•°æ®ç»“æ„å­˜å‚¨äº† slice çš„å¼€å§‹ä½ç½®å’Œé•¿åº¦ï¼Œé•¿åº¦å¯¹åº”äº `ending_index` å‡å» `starting_index` çš„å€¼ã€‚æ‰€ä»¥å¯¹äº `let world = &s[6..11];` çš„æƒ…å†µï¼Œ`world` å°†æ˜¯ä¸€ä¸ªåŒ…å«æŒ‡å‘ `s` ç´¢å¼• 6 çš„æŒ‡é’ˆå’Œé•¿åº¦å€¼ 5 çš„ sliceã€‚

![world containing a pointer to the byte at index 6 of String s and a length 5](https://rustwiki.org/zh-CN/book/img/trpl04-06.svg)

å¯¹äº Rust çš„ `..` range è¯­æ³•ï¼Œå¦‚æœæƒ³è¦ä»ç´¢å¼• 0 å¼€å§‹ï¼Œå¯ä»¥ä¸å†™ä¸¤ä¸ªç‚¹å·ä¹‹å‰çš„å€¼ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚ä¸‹ä¸¤ä¸ªè¯­å¥æ˜¯ç›¸åŒçš„ï¼š

```rust
#![allow(unused)]
fn main() {
    let s = String::from("hello");

    let slice = &s[0..2];
    let slice = &s[..2];
}
```

ä¾æ­¤ç±»æ¨ï¼Œå¦‚æœ slice åŒ…å« `String` çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå¯ä»¥èˆå¼ƒå°¾éƒ¨çš„æ•°å­—ã€‚è¿™æ„å‘³ç€å¦‚ä¸‹ä¹Ÿæ˜¯ç›¸åŒçš„ï¼š

```rust
#![allow(unused)]
fn main() {
    let s = String::from("hello");

    let len = s.len();

    let slice = &s[3..len];
    let slice = &s[3..];
}
```

ä¹Ÿå¯ä»¥åŒæ—¶èˆå¼ƒè¿™ä¸¤ä¸ªå€¼æ¥è·å–æ•´ä¸ªå­—ç¬¦ä¸²çš„ sliceã€‚æ‰€ä»¥å¦‚ä¸‹äº¦æ˜¯ç›¸åŒçš„ï¼š

```rust
#![allow(unused)]
fn main() {
    let s = String::from("hello");

    let len = s.len();

    let slice = &s[0..len];
    let slice = &s[..];
}
```

*å­—ç¬¦ä¸² slice range çš„ç´¢å¼•å¿…é¡»ä½äºæœ‰æ•ˆçš„ UTF-8 å­—ç¬¦è¾¹ç•Œå†…ï¼Œå¦‚æœå°è¯•ä»ä¸€ä¸ªå¤šå­—èŠ‚å­—ç¬¦çš„ä¸­é—´ä½ç½®åˆ›å»ºå­—ç¬¦ä¸² sliceï¼Œåˆ™ç¨‹åºå°†ä¼šå› é”™è¯¯è€Œé€€å‡ºã€‚å‡ºäºä»‹ç»å­—ç¬¦ä¸² slice çš„ç›®çš„ï¼Œæœ¬éƒ¨åˆ†å‡è®¾åªä½¿ç”¨ ASCII å­—ç¬¦é›†ï¼›*

åœ¨è®°ä½æ‰€æœ‰è¿™äº›çŸ¥è¯†åï¼Œè®©æˆ‘ä»¬é‡å†™ `first_word` æ¥è¿”å›ä¸€ä¸ª sliceã€‚â€œå­—ç¬¦ä¸² sliceâ€ çš„ç±»å‹å£°æ˜å†™ä½œ `&str`ï¼š

```rust
fn first_word(s: &String) -> &str {
    let bytes = s.as_bytes();

    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[0..i];
        }
    }

    &s[..]
}
```

æˆ‘ä»¬ä½¿ç”¨è·Ÿç¤ºä¾‹ 4-7 ç›¸åŒçš„æ–¹å¼è·å–å•è¯ç»“å°¾çš„ç´¢å¼•ï¼Œé€šè¿‡å¯»æ‰¾ç¬¬ä¸€ä¸ªå‡ºç°çš„ç©ºæ ¼ã€‚å½“æ‰¾åˆ°ä¸€ä¸ªç©ºæ ¼ï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸² sliceï¼Œå®ƒä½¿ç”¨å­—ç¬¦ä¸²çš„å¼€å§‹å’Œç©ºæ ¼çš„ç´¢å¼•ä½œä¸ºå¼€å§‹å’Œç»“æŸçš„ç´¢å¼•ã€‚

ç°åœ¨å½“è°ƒç”¨ `first_word` æ—¶ï¼Œä¼šè¿”å›ä¸åº•å±‚æ•°æ®å…³è”çš„å•ä¸ªå€¼ã€‚è¿™ä¸ªå€¼ç”±ä¸€ä¸ª slice å¼€å§‹ä½ç½®çš„å¼•ç”¨å’Œ slice ä¸­å…ƒç´ çš„æ•°é‡ç»„æˆã€‚

##### å­—ç¬¦ä¸²å­—é¢é‡å°±æ˜¯ slice

```rust
let s = "Hello, world!";
```

è¿™é‡Œ `s` çš„ç±»å‹æ˜¯ `&str`ï¼šå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘äºŒè¿›åˆ¶ç¨‹åºç‰¹å®šä½ç½®çš„ sliceã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²å­—é¢é‡æ˜¯ä¸å¯å˜çš„ï¼›`&str` æ˜¯ä¸€ä¸ªä¸å¯å˜å¼•ç”¨ã€‚

##### å­—ç¬¦ä¸² slice ä½œä¸ºå‚æ•°

- å‚æ•°ä¸º `&str` å¯ä»¥ä½¿ç”¨`String` å€¼å’Œ `&str` å€¼

```rust
fn first_word(s: &str) -> &str {
```

å¦‚æœæœ‰ä¸€ä¸ªå­—ç¬¦ä¸² sliceï¼Œå¯ä»¥ç›´æ¥ä¼ é€’å®ƒã€‚å¦‚æœæœ‰ä¸€ä¸ª `String`ï¼Œåˆ™å¯ä»¥ä¼ é€’æ•´ä¸ª `String` çš„ slice æˆ–å¯¹ `String` çš„å¼•ç”¨ã€‚è¿™ç§çµæ´»æ€§åˆ©ç”¨äº† *deref coercions* çš„ä¼˜åŠ¿ã€‚

```rust
fn first_word(s: &str) -> &str {
    let bytes = s.as_bytes();

    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[0..i];
        }
    }

    &s[..]
}

fn main() {
    let my_string = String::from("hello world");

    // `first_word` æ¥å— `String` çš„åˆ‡ç‰‡ï¼Œæ— è®ºæ˜¯éƒ¨åˆ†è¿˜æ˜¯å…¨éƒ¨
    let word = first_word(&my_string[0..6]);
    let word = first_word(&my_string[..]);
    // `first_word` ä¹Ÿæ¥å— `String` çš„å¼•ç”¨ï¼Œ
    // è¿™ç­‰åŒäº `String` çš„å…¨éƒ¨åˆ‡ç‰‡
    let word = first_word(&my_string);

    let my_string_literal = "hello world";

    // `first_word` æ¥å—å­—ç¬¦ä¸²å­—é¢é‡çš„åˆ‡ç‰‡ï¼Œæ— è®ºæ˜¯éƒ¨åˆ†è¿˜æ˜¯å…¨éƒ¨
    let word = first_word(&my_string_literal[0..6]);
    let word = first_word(&my_string_literal[..]);

    // å› ä¸ºå­—ç¬¦ä¸²å­—é¢å€¼**å°±æ˜¯**å­—ç¬¦ä¸² sliceï¼Œ
    // è¿™æ ·å†™ä¹Ÿå¯ä»¥ï¼Œå³ä¸ä½¿ç”¨ slice è¯­æ³•ï¼
    let word = first_word(my_string_literal);
}
```

##### å…¶ä»–ç±»å‹çš„ slice

å°±è·Ÿæˆ‘ä»¬æƒ³è¦è·å–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†é‚£æ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæƒ³è¦å¼•ç”¨æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š

```rust
let a = [1, 2, 3, 4, 5];
let slice = &a[1..3];
```

è¿™ä¸ª slice çš„ç±»å‹æ˜¯ `&[i32]`ã€‚å®ƒè·Ÿå­—ç¬¦ä¸² slice çš„å·¥ä½œæ–¹å¼ä¸€æ ·ï¼Œé€šè¿‡å­˜å‚¨ç¬¬ä¸€ä¸ªé›†åˆå…ƒç´ çš„å¼•ç”¨å’Œä¸€ä¸ªé›†åˆæ€»é•¿åº¦ã€‚ä½ å¯ä»¥å¯¹å…¶ä»–æ‰€æœ‰é›†åˆä½¿ç”¨è¿™ç±» sliceã€‚



# Struct

*struct*ï¼Œæˆ–è€… *structure*ï¼Œæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œå…è®¸ä½ å‘½åå’ŒåŒ…è£…å¤šä¸ªç›¸å…³çš„å€¼ï¼Œä»è€Œå½¢æˆä¸€ä¸ªæœ‰æ„ä¹‰çš„ç»„åˆã€‚**ç»“æ„ä½“çš„æ¯ä¸€éƒ¨åˆ†å¯ä»¥æ˜¯ä¸åŒç±»å‹**ã€‚ä½†ä¸åŒäºå…ƒç»„ï¼Œç»“æ„ä½“éœ€è¦å‘½åå„éƒ¨åˆ†æ•°æ®ä»¥ä¾¿èƒ½æ¸…æ¥šçš„è¡¨æ˜å…¶å€¼çš„æ„ä¹‰ã€‚ç”±äºæœ‰äº†è¿™äº›åå­—ï¼Œç»“æ„ä½“æ¯”å…ƒç»„æ›´çµæ´»ï¼šä¸éœ€è¦ä¾èµ–é¡ºåºæ¥æŒ‡å®šæˆ–è®¿é—®å®ä¾‹ä¸­çš„å€¼ã€‚

å®šä¹‰ç»“æ„ä½“ï¼Œéœ€è¦ä½¿ç”¨ `struct` å…³é”®å­—å¹¶ä¸ºæ•´ä¸ªç»“æ„ä½“æä¾›ä¸€ä¸ªåå­—ã€‚ç»“æ„ä½“çš„åå­—éœ€è¦æè¿°å®ƒæ‰€ç»„åˆçš„æ•°æ®çš„æ„ä¹‰ã€‚æ¥ç€ï¼Œåœ¨å¤§æ‹¬å·ä¸­ï¼Œå®šä¹‰æ¯ä¸€éƒ¨åˆ†æ•°æ®çš„åå­—å’Œç±»å‹ï¼Œæˆ‘ä»¬ç§°ä¸º **å­—æ®µ**ï¼ˆ*field*ï¼‰ã€‚

```rust
// ä¸€ä¸ªå­˜å‚¨ç”¨æˆ·è´¦å·ä¿¡æ¯çš„ç»“æ„ä½“
struct User {
    active: bool,
    username: String,
    email: String,
    sign_in_count: u64,
}
```

